# Core Router åŒ…æ–‡æ¡£

## æ¦‚è¿°

`core/router` åŒ…æ˜¯Flux Ledgeråº”ç”¨çš„è·¯ç”±å¯¼èˆªæ ¸å¿ƒï¼ŒåŸºäºGoRouterå®ç°å£°æ˜å¼è·¯ç”±ç®¡ç†ã€‚å®ƒè´Ÿè´£åº”ç”¨çš„é¡µé¢å¯¼èˆªã€å‚æ•°ä¼ é€’ã€è·¯ç”±å®ˆå«å’Œæ·±å±‚é“¾æ¥å¤„ç†ã€‚

**æ–‡ä»¶ç»Ÿè®¡**: 1ä¸ªDartæ–‡ä»¶ï¼Œå®šä¹‰å®Œæ•´çš„è·¯ç”±é…ç½®

## æ¶æ„å®šä½

### å±‚çº§å…³ç³»
```
UI Layer (Screens)                  # é¡µé¢ç»„ä»¶
    â†‘ (è·¯ç”±è·³è½¬)
core/router/                        # ğŸ”µ å½“å‰å±‚çº§ - è·¯ç”±é…ç½®
    â†‘ (è·¯ç”±æ³¨å†Œ)
main.dart / main_flux.dart           # åº”ç”¨å…¥å£
    â†‘ (MaterialApp.router)
Flutter Framework                    # ç³»ç»Ÿæ¡†æ¶
```

### èŒè´£è¾¹ç•Œ
- âœ… **è·¯ç”±é…ç½®**: å®šä¹‰æ‰€æœ‰é¡µé¢è·¯ç”±å’Œå¯¼èˆªç»“æ„
- âœ… **å‚æ•°ä¼ é€’**: å®‰å…¨åœ°ä¼ é€’è·¯ç”±å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°
- âœ… **è·¯ç”±å®ˆå«**: å¤„ç†è·¯ç”±æƒé™å’Œæ¡ä»¶å¯¼èˆª
- âœ… **æ·±å±‚é“¾æ¥**: æ”¯æŒå¤–éƒ¨é“¾æ¥ç›´æ¥è·³è½¬åˆ°åº”ç”¨å†…é¡µé¢
- âŒ **é¡µé¢æ¸²æŸ“**: ä¸è´Ÿè´£å…·ä½“é¡µé¢çš„UIæ¸²æŸ“

## æ ¸å¿ƒæ–‡ä»¶

### FluxRouter (`flux_router.dart`)
**èŒè´£**: Flux Ledgerçš„å®Œæ•´è·¯ç”±é…ç½®ç®¡ç†å™¨

**æ ¸å¿ƒåŠŸèƒ½**:
- GoRouterå®ä¾‹é…ç½®å’Œç®¡ç†
- è·¯ç”±å¸¸é‡å®šä¹‰
- é¡µé¢è½¬åœºåŠ¨ç”»é…ç½®
- è·¯ç”±å‚æ•°éªŒè¯å’Œå¤„ç†

**æ¶æ„è®¾è®¡**:
```dart
class FluxRouter {
  static GoRouter get router => _router;

  static final _router = GoRouter(
    routes: _routes,
    initialLocation: FluxRoutes.dashboard,
    redirect: _handleRedirect,
    observers: [FluxNavigatorObserver()],
  );
}
```

## è·¯ç”±ç»“æ„

### ä¸»è¦è·¯ç”±å±‚çº§
```
FluxRoutes (è·¯ç”±å¸¸é‡ç±»)
â”œâ”€â”€ dashboard          # ä»ªè¡¨æ¿é¦–é¡µ
â”œâ”€â”€ streams            # æµç®¡é“ (äº¤æ˜“å½•å…¥)
â”œâ”€â”€ insights           # æµæ´å¯Ÿ (AIåˆ†æ)
â”œâ”€â”€ settings           # è®¾ç½®é¡µé¢
â”œâ”€â”€ aiConfig           # AIé…ç½®é¡µé¢
â”œâ”€â”€ familyInfo         # å®¶åº­ä¿¡æ¯æ¨¡å—
â”‚   â”œâ”€â”€ salarySetup    # å·¥èµ„è®¾ç½®
â”‚   â”œâ”€â”€ assetMgmt      # èµ„äº§ç®¡ç†
â”‚   â””â”€â”€ walletMgmt     # é’±åŒ…ç®¡ç†
â”œâ”€â”€ transactionFlow    # äº¤æ˜“æµæ°´æ¨¡å—
â””â”€â”€ financialPlanning  # è´¢åŠ¡è®¡åˆ’æ¨¡å—
```

### è·¯ç”±é…ç½®æ¨¡å¼
```dart
static final _routes = [
  GoRoute(
    path: FluxRoutes.dashboard,
    name: 'dashboard',
    builder: (context, state) => const DashboardHomeScreen(),
  ),
  GoRoute(
    path: FluxRoutes.streams,
    name: 'streams',
    builder: (context, state) => const UnifiedTransactionEntryScreen(),
  ),
  // ... æ›´å¤šè·¯ç”±
];
```

## å…³è”å…³ç³»

### ä¸UIå±‚çš„å…³è”
**è¢«ä¾èµ–å…³ç³»**:
- `screens/main_navigation_screen.dart` - ä½¿ç”¨è·¯ç”±å¸¸é‡è¿›è¡Œé¡µé¢è·³è½¬
- `screens/settings_screen.dart` - å¯¼èˆªåˆ°AIé…ç½®é¡µé¢
- `widgets/navigable_list_item.dart` - å¤åˆç»„ä»¶çš„è·¯ç”±è·³è½¬

**ä¾èµ–å…³ç³»**:
- `screens/` - æ‰€æœ‰é¡µé¢ç»„ä»¶ (è·¯ç”±ç›®æ ‡)
- `core/widgets/` - å¯¼èˆªç›¸å…³ç»„ä»¶

### ä¸å…¶ä»–æ ¸å¿ƒæ¨¡å—çš„å…³è”
**çŠ¶æ€ç®¡ç†å…³è”**:
- `providers/stream_insights_flag_provider.dart` - åŠŸèƒ½å¼€å…³å½±å“è·¯ç”±é…ç½®
- `providers/theme_provider.dart` - ä¸»é¢˜å¯èƒ½å½±å“è·¯ç”±åŠ¨ç”»

**æœåŠ¡å±‚å…³è”**:
- `services/logging_service.dart` - è·¯ç”±å¯¼èˆªæ—¥å¿—è®°å½•

## è·¯ç”±å¯¼èˆªæ¨¡å¼

### å£°æ˜å¼å¯¼èˆª
```dart
// åŸºç¡€å¯¼èˆª
context.go(FluxRoutes.dashboard);

// å¸¦å‚æ•°å¯¼èˆª
context.go('${FluxRoutes.transactionDetail}/$transactionId');

// è¿”å›å¯¼èˆª
context.pop();
```

### è·¯ç”±å®ˆå«
```dart
static String? _handleRedirect(BuildContext context, GoRouterState state) {
  // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
  // éªŒè¯è·¯ç”±æƒé™
  // å¤„ç†æ·±å±‚é“¾æ¥é‡å®šå‘
  return null; // æ— éœ€é‡å®šå‘
}
```

## è®¾è®¡åŸåˆ™

### 1. è·¯ç”±å¸¸é‡åŒ–
æ‰€æœ‰è·¯ç”±è·¯å¾„éƒ½å®šä¹‰ä¸ºå¸¸é‡ï¼Œé¿å…é­”æ³•å­—ç¬¦ä¸²ã€‚

### 2. ç±»å‹å®‰å…¨
ä½¿ç”¨å¼ºç±»å‹è·¯ç”±å‚æ•°ï¼Œç¡®ä¿å‚æ•°ä¼ é€’çš„å®‰å…¨æ€§ã€‚

### 3. å“åº”å¼è·¯ç”±
è·¯ç”±é…ç½®å¯ä»¥æ ¹æ®åº”ç”¨çŠ¶æ€åŠ¨æ€è°ƒæ•´ã€‚

### 4. å¯æ‰©å±•æ€§
æ–°çš„è·¯ç”±å¯ä»¥è½»æ¾æ·»åŠ åˆ°ç°æœ‰é…ç½®ä¸­ã€‚

### 5. é”™è¯¯å¤„ç†
å®Œå–„çš„è·¯ç”±é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢å¯¼èˆªåˆ°ä¸å­˜åœ¨çš„é¡µé¢ã€‚

## è·¯ç”±ç”Ÿå‘½å‘¨æœŸ

### å¯¼èˆªæµç¨‹
```
ç”¨æˆ·æ“ä½œ â†’ è·¯ç”±è§£æ â†’ å‚æ•°éªŒè¯ â†’ è·¯ç”±å®ˆå«æ£€æŸ¥ â†’ é¡µé¢æ„å»º â†’ åŠ¨ç”»è½¬åœº â†’ é¡µé¢æ˜¾ç¤º
```

### é¡µé¢æ ˆç®¡ç†
- æ”¯æŒå¤šå±‚çº§é¡µé¢æ ˆç®¡ç†
- æ™ºèƒ½çš„è¿”å›æ ˆå¤„ç†
- é¡µé¢çŠ¶æ€ä¿æŒæœºåˆ¶

## æ€§èƒ½ä¼˜åŒ–

### 1. æ‡’åŠ è½½
é¡µé¢ç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Œæé«˜åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚

### 2. ç¼“å­˜ç­–ç•¥
å¸¸ç”¨è·¯ç”±çš„é¡µé¢å®ä¾‹ç¼“å­˜ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚

### 3. åŠ¨ç”»ä¼˜åŒ–
æµç•…çš„é¡µé¢è½¬åœºåŠ¨ç”»ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚

### 4. å†…å­˜ç®¡ç†
åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„é¡µé¢å®ä¾‹ï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨ã€‚

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æµ‹è¯•è·¯ç”±é…ç½®æ­£ç¡®æ€§
- æµ‹è¯•å‚æ•°ä¼ é€’é€»è¾‘
- æµ‹è¯•è·¯ç”±å®ˆå«åŠŸèƒ½

### é›†æˆæµ‹è¯•
- æµ‹è¯•å®Œæ•´çš„å¯¼èˆªæµç¨‹
- æµ‹è¯•æ·±å±‚é“¾æ¥å¤„ç†
- æµ‹è¯•é”™è¯¯åœºæ™¯å¤„ç†

### UIæµ‹è¯•
- æµ‹è¯•é¡µé¢è·³è½¬åŠ¨ç”»
- æµ‹è¯•å¯¼èˆªæ äº¤äº’
- æµ‹è¯•è¿”å›æ“ä½œ

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°è·¯ç”±
```dart
// 1. åœ¨FluxRoutesä¸­æ·»åŠ å¸¸é‡
class FluxRoutes {
  static const String newFeature = '/new-feature';
}

// 2. åœ¨è·¯ç”±é…ç½®ä¸­æ·»åŠ è·¯ç”±
GoRoute(
  path: FluxRoutes.newFeature,
  name: 'new_feature',
  builder: (context, state) => const NewFeatureScreen(),
),
```

### æ·»åŠ è·¯ç”±å‚æ•°
```dart
// æ”¯æŒè·¯å¾„å‚æ•°
GoRoute(
  path: '/transaction/:id',
  builder: (context, state) {
    final id = state.pathParameters['id']!;
    return TransactionDetailScreen(transactionId: id);
  },
),
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **è·¯ç”±æœªæ‰¾åˆ°**: æ£€æŸ¥è·¯ç”±è·¯å¾„å’Œåç§°æ˜¯å¦æ­£ç¡®å®šä¹‰
2. **å‚æ•°ä¼ é€’å¤±è´¥**: éªŒè¯å‚æ•°ç±»å‹å’Œè·¯ç”±é…ç½®
3. **å¯¼èˆªå¼‚å¸¸**: æ£€æŸ¥è·¯ç”±å®ˆå«å’Œé‡å®šå‘é€»è¾‘

## ç›¸å…³æ–‡æ¡£

- [CoreåŒ…æ€»æ–‡æ¡£](../README.md)
- [æ•´ä½“æ¶æ„æ–‡æ¡£](../../ARCHITECTURE.md)
- [UIè®¾è®¡ç³»ç»Ÿæ–‡æ¡£](../../../.cursor/rules/ui-design-system.mdc)
