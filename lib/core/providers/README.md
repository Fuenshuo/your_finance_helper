# Core Providers åŒ…æ–‡æ¡£

## æ¦‚è¿°

`core/providers` åŒ…æ˜¯Flux Ledgeråº”ç”¨çš„æ ¸å¿ƒçŠ¶æ€ç®¡ç†å±‚ï¼Œè´Ÿè´£è¿æ¥UIç•Œé¢ä¸ä¸šåŠ¡é€»è¾‘æ•°æ®ã€‚å®ƒé‡‡ç”¨Provideræ¨¡å¼ç®¡ç†åº”ç”¨çŠ¶æ€ï¼Œæä¾›ç±»å‹å®‰å…¨çš„çŠ¶æ€è®¿é—®å’Œå˜æ›´é€šçŸ¥ã€‚

**æ–‡ä»¶ç»Ÿè®¡**: 11ä¸ªDartæ–‡ä»¶ï¼Œæ¶µç›–è´¢åŠ¡æ•°æ®çš„å®Œæ•´çŠ¶æ€ç®¡ç†

## æ¶æ„å®šä½

### å±‚çº§å…³ç³»
```
UI Layer (Screens/Widgets)          # ä½¿ç”¨çŠ¶æ€
    â†“ (Provider.of() / Consumer)
core/providers/                     # ğŸ”µ å½“å‰å±‚çº§ - çŠ¶æ€ç®¡ç†
    â†“ (è°ƒç”¨ä¸šåŠ¡é€»è¾‘)
core/services/                      # ä¸šåŠ¡é€»è¾‘å±‚
    â†“ (æ•°æ®æŒä¹…åŒ–)
core/database/ + SharedPreferences  # æ•°æ®å­˜å‚¨å±‚
```

### èŒè´£è¾¹ç•Œ
- âœ… **çŠ¶æ€ç®¡ç†**: æä¾›å“åº”å¼çŠ¶æ€è®¿é—®å’Œå˜æ›´é€šçŸ¥
- âœ… **æ•°æ®åŒæ­¥**: è¿æ¥UIä¸ä¸šåŠ¡é€»è¾‘å±‚
- âœ… **ç¼“å­˜ç®¡ç†**: ä¼˜åŒ–æ•°æ®è®¿é—®æ€§èƒ½
- âœ… **åˆå§‹åŒ–ç®¡ç†**: å¤„ç†Providerç”Ÿå‘½å‘¨æœŸ

## Provideråˆ†ç±»

### 1. è´¢åŠ¡å®ä½“Provider (7ä¸ªæ–‡ä»¶)

#### AccountProvider (`account_provider.dart`)
**èŒè´£**: ç®¡ç†é’±åŒ…è´¦æˆ·çŠ¶æ€ï¼ˆç°é‡‘ã€é“¶è¡Œå¡ã€ç”µå­é’±åŒ…ç­‰ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- è´¦æˆ·åˆ—è¡¨ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- è´¦æˆ·ä½™é¢å®æ—¶è®¡ç®—
- è´¦æˆ·ç±»å‹åˆ†ç±»ç®¡ç†

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `StorageService` (æ•°æ®æŒä¹…åŒ–)
- **è¢«ä¾èµ–**: `screens/wallet_management_screen.dart` (UIå±•ç¤º)
- **çº§è”å½±å“**: `TransactionProvider` (äº¤æ˜“åˆ›å»ºæ—¶æ›´æ–°ä½™é¢)

#### AssetProvider (`asset_provider.dart`)
**èŒè´£**: ç®¡ç†å®¶åº­èµ„äº§çŠ¶æ€ï¼ˆæˆ¿äº§ã€è‚¡ç¥¨ã€åŸºé‡‘ç­‰ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- èµ„äº§åˆ†ç±»ç®¡ç†ï¼ˆäº”å¤§èµ„äº§åˆ†ç±»ï¼‰
- èµ„äº§ä¼°å€¼è®¡ç®—
- èµ„äº§å†å²è®°å½•

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `AssetHistoryService` (å†å²è®°å½•)
- **è¢«ä¾èµ–**: `screens/asset_management_screen.dart` (èµ„äº§ç®¡ç†é¡µé¢)
- **çº§è”å½±å“**: `BudgetProvider` (èµ„äº§å½±å“é¢„ç®—å»ºè®®)

#### BudgetProvider (`budget_provider.dart`)
**èŒè´£**: ç®¡ç†é¢„ç®—çŠ¶æ€ï¼ˆä¿¡å°é¢„ç®—ã€é›¶åŸºé¢„ç®—ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- é¢„ç®—åˆ›å»ºå’Œé…ç½®
- é¢„ç®—ä½¿ç”¨æƒ…å†µè·Ÿè¸ª
- é¢„ç®—æ‰§è¡Œç›‘æ§

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `StorageService` (é¢„ç®—æ•°æ®å­˜å‚¨)
- **è¢«ä¾èµ–**: `features/family_info/screens/` (é¢„ç®—é…ç½®é¡µé¢)
- **çº§è”å½±å“**: `TransactionProvider` (äº¤æ˜“å…³è”é¢„ç®—)

#### ExpensePlanProvider (`expense_plan_provider.dart`)
**èŒè´£**: ç®¡ç†æ”¯å‡ºè®¡åˆ’çŠ¶æ€

**æ ¸å¿ƒåŠŸèƒ½**:
- å®šæœŸæ”¯å‡ºè®¡åˆ’é…ç½®
- è®¡åˆ’æ‰§è¡ŒçŠ¶æ€è·Ÿè¸ª
- è®¡åˆ’æé†’ç®¡ç†

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `StorageService` (è®¡åˆ’æ•°æ®)
- **è¢«ä¾èµ–**: `features/financial_planning/` (è®¡åˆ’ç®¡ç†é¡µé¢)
- **çº§è”å½±å“**: `TransactionProvider` (è‡ªåŠ¨ç”Ÿæˆäº¤æ˜“)

#### IncomePlanProvider (`income_plan_provider.dart`)
**èŒè´£**: ç®¡ç†æ”¶å…¥è®¡åˆ’çŠ¶æ€

**æ ¸å¿ƒåŠŸèƒ½**:
- å·¥èµ„æ”¶å…¥è®¡åˆ’é…ç½®
- æŠ•èµ„æ”¶ç›Šè®¡åˆ’ç®¡ç†
- æ”¶å…¥é¢„æµ‹è®¡ç®—

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `StorageService` (æ”¶å…¥æ•°æ®)
- **è¢«ä¾èµ–**: `features/financial_planning/` (æ”¶å…¥è®¡åˆ’é¡µé¢)
- **çº§è”å½±å“**: `BudgetProvider` (å½±å“é¢„ç®—å»ºè®®)

#### TransactionProvider (`transaction_provider.dart`)
**èŒè´£**: ç®¡ç†äº¤æ˜“è®°å½•çŠ¶æ€ï¼ˆæ ¸å¿ƒçŠ¶æ€ç®¡ç†å™¨ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- äº¤æ˜“è®°å½•CRUDæ“ä½œ
- äº¤æ˜“æœç´¢å’Œç­›é€‰
- äº¤æ˜“ç»Ÿè®¡è®¡ç®—

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `StorageService`, `AccountProvider`, `BudgetProvider`
- **è¢«ä¾èµ–**: `screens/unified_transaction_entry_screen.dart` (äº¤æ˜“å½•å…¥)
- **çº§è”å½±å“**: æ‰€æœ‰è´¢åŠ¡è®¡ç®—Provider (ä½™é¢æ›´æ–°ã€é¢„ç®—æ‰£å‡)

### 2. åŠŸèƒ½ç‰¹æ€§Provider (4ä¸ªæ–‡ä»¶)

#### ThemeProvider (`theme_provider.dart`)
**èŒè´£**: ç®¡ç†åº”ç”¨ä¸»é¢˜çŠ¶æ€

**æ ¸å¿ƒåŠŸèƒ½**:
- äº®è‰²/æš—è‰²ä¸»é¢˜åˆ‡æ¢
- ä¸»é¢˜é…ç½®æŒä¹…åŒ–
- åŠ¨æ€ä¸»é¢˜åº”ç”¨

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `SharedPreferences` (ä¸»é¢˜è®¾ç½®å­˜å‚¨)
- **è¢«ä¾èµ–**: æ‰€æœ‰UIç»„ä»¶ (ä¸»é¢˜é¢œè‰²è·å–)
- **çº§è”å½±å“**: `AppDesignTokens` (ä¸»é¢˜ç›¸å…³è®¾è®¡ä»¤ç‰Œ)

#### ThemeStyleProvider (`theme_style_provider.dart`)
**èŒè´£**: ç®¡ç†ä¸»é¢˜æ ·å¼å˜ä½“

**æ ¸å¿ƒåŠŸèƒ½**:
- é‡‘é¢é¢œè‰²ä¸»é¢˜åˆ‡æ¢ï¼ˆFlux Blue/ Forest Emerald/ Graphiteï¼‰
- æ ·å¼é…ç½®æŒä¹…åŒ–
- æ ·å¼å˜ä½“ç®¡ç†

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `SharedPreferences` (æ ·å¼è®¾ç½®)
- **è¢«ä¾èµ–**: `core/theme/app_design_tokens.dart` (æ ·å¼åº”ç”¨)
- **çº§è”å½±å“**: æ‰€æœ‰é‡‘é¢æ˜¾ç¤ºç»„ä»¶

#### StreamInsightsFlagProvider (`stream_insights_flag_provider.dart`)
**èŒè´£**: ç®¡ç†åŠŸèƒ½å¼€å…³çŠ¶æ€ï¼ˆStream Insightsç‰¹æ€§ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- åŠŸèƒ½å¼€å…³çŠ¶æ€ç®¡ç†
- æœ¬åœ°è°ƒè¯•è¦†ç›–æ”¯æŒ
- è¿œç¨‹é…ç½®é›†æˆå‡†å¤‡

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `SharedPreferences` (å¼€å…³çŠ¶æ€)
- **è¢«ä¾èµ–**: `screens/main_navigation_screen.dart` (UIæ¡ä»¶æ¸²æŸ“)
- **çº§è”å½±å“**: `core/router/flux_router.dart` (è·¯ç”±é…ç½®)

#### FluxProviders (`flux_providers.dart`)
**èŒè´£**: Flux Ledgerä¸“ç”¨Provideré›†åˆ

**æ ¸å¿ƒåŠŸèƒ½**:
- æµä½“éªŒçŠ¶æ€ç®¡ç†
- æ´å¯Ÿæ•°æ®çŠ¶æ€ç®¡ç†
- Fluxç‰¹å®šä¸šåŠ¡é€»è¾‘

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `InsightService`, `TransactionProvider`
- **è¢«ä¾èµ–**: `features/insights/` (æ´å¯ŸåŠŸèƒ½)
- **çº§è”å½±å“**: `screens/flux_*` (Fluxé¡µé¢ç»„ä»¶)

## æ¶æ„æ¨¡å¼

### Provideræ¨¡å¼
```dart
class AccountProvider extends ChangeNotifier {
  List<Account> _accounts = [];
  List<Account> get accounts => _accounts;

  Future<void> addAccount(Account account) async {
    _accounts.add(account);
    await _storageService.saveAccount(account);
    notifyListeners(); // é€šçŸ¥UIæ›´æ–°
  }
}
```

### ä½¿ç”¨æ¨¡å¼
```dart
// UIå±‚ä½¿ç”¨
class AccountListWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Consumer<AccountProvider>(
      builder: (context, provider, child) {
        return ListView.builder(
          itemCount: provider.accounts.length,
          itemBuilder: (context, index) {
            return AccountCard(provider.accounts[index]);
          },
        );
      },
    );
  }
}
```

## æ•°æ®æµå‘

### çŠ¶æ€æ›´æ–°æµ
```
ç”¨æˆ·æ“ä½œ â†’ UIäº‹ä»¶ â†’ Provideræ–¹æ³•è°ƒç”¨ â†’ ä¸šåŠ¡é€»è¾‘å¤„ç† â†’ æ•°æ®æŒä¹…åŒ– â†’ notifyListeners() â†’ UIé‡æ–°æ¸²æŸ“
```

### ä¾èµ–å…³ç³»å›¾
```
TransactionProvider (æ ¸å¿ƒ)
â”œâ”€â”€ AccountProvider (è´¦æˆ·ä½™é¢æ›´æ–°)
â”œâ”€â”€ BudgetProvider (é¢„ç®—ä½¿ç”¨æ›´æ–°)
â”œâ”€â”€ ExpensePlanProvider (æ”¯å‡ºè®¡åˆ’å…³è”)
â””â”€â”€ IncomePlanProvider (æ”¶å…¥è®¡åˆ’å…³è”)

ThemeProvider (ä¸»é¢˜)
â””â”€â”€ ThemeStyleProvider (æ ·å¼å˜ä½“)

StreamInsightsFlagProvider (åŠŸèƒ½å¼€å…³)
â”œâ”€â”€ FluxProviders (æµä½“éªŒ)
â””â”€â”€ Routeré…ç½® (é¡µé¢åˆ‡æ¢)
```

## è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£
æ¯ä¸ªProvideråªç®¡ç†ä¸€ä¸ªæ˜ç¡®çš„çŠ¶æ€é¢†åŸŸï¼Œé¿å…èŒè´£äº¤å‰ã€‚

### 2. ä¾èµ–æ³¨å…¥
é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•å’Œè§£è€¦ã€‚

### 3. å¼‚æ­¥æ“ä½œ
æ‰€æœ‰æ•°æ®æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¿è¯UIå“åº”æ€§ã€‚

### 4. é”™è¯¯å¤„ç†
å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œé˜²æ­¢çŠ¶æ€ä¸ä¸€è‡´ã€‚

### 5. çŠ¶æ€æŒä¹…åŒ–
é‡è¦çŠ¶æ€è‡ªåŠ¨æŒä¹…åŒ–ï¼Œä¿è¯åº”ç”¨é‡å¯åçŠ¶æ€æ¢å¤ã€‚

## æ€§èƒ½ä¼˜åŒ–

### 1. é€‰æ‹©æ€§é€šçŸ¥
ä½¿ç”¨`notifyListeners()`è¿›è¡Œç²¾ç¡®çš„çŠ¶æ€æ›´æ–°ï¼Œé¿å…ä¸å¿…è¦çš„é‡ç»˜ã€‚

### 2. æ•°æ®ç¼“å­˜
åœ¨å†…å­˜ä¸­ç¼“å­˜å¸¸ç”¨æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ã€‚

### 3. æ‡’åŠ è½½
æŒ‰éœ€åŠ è½½æ•°æ®ï¼Œæé«˜åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚

### 4. æ‰¹é‡æ“ä½œ
æ”¯æŒæ‰¹é‡æ•°æ®æ“ä½œï¼Œå‡å°‘æ•°æ®åº“äº‹åŠ¡å¼€é”€ã€‚

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æµ‹è¯•çŠ¶æ€å˜æ›´é€»è¾‘
- æµ‹è¯•æ•°æ®è½¬æ¢åŠŸèƒ½
- æµ‹è¯•é”™è¯¯å¤„ç†åœºæ™¯

### é›†æˆæµ‹è¯•
- æµ‹è¯•ä¸Serviceå±‚çš„äº¤äº’
- æµ‹è¯•æ•°æ®æŒä¹…åŒ–æµç¨‹
- æµ‹è¯•çŠ¶æ€åŒæ­¥æœºåˆ¶

### Widgetæµ‹è¯•
- æµ‹è¯•Providerä¸UIçš„é›†æˆ
- æµ‹è¯•çŠ¶æ€å˜æ›´çš„UIå“åº”

## ç›¸å…³æ–‡æ¡£

- [CoreåŒ…æ€»æ–‡æ¡£](../README.md)
- [æ•°æ®æµæ¶æ„](../../ARCHITECTURE.md)
- [çŠ¶æ€ç®¡ç†æ¶æ„](../../ARCHITECTURE.md#çŠ¶æ€ç®¡ç†æ¶æ„)

