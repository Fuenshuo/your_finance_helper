# Core Utils å·¥å…·ç±»æ–‡æ¡£

## æ¦‚è¿°

`core/utils/` æ˜¯Flux Ledgerçš„å·¥å…·å‡½æ•°é›†åˆï¼Œæä¾›é€šç”¨çš„è¾…åŠ©åŠŸèƒ½å’Œè·¨æ¨¡å—å…±äº«çš„å®ç”¨å·¥å…·ï¼Œæ”¯æŒåº”ç”¨çš„å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

**æ–‡ä»¶ç»Ÿè®¡**: 10ä¸ªDartæ–‡ä»¶ï¼Œå®ç°11ä¸ªæ ¸å¿ƒå·¥å…·æ¨¡å—

## æ¶æ„å®šä½

### å±‚çº§å…³ç³»
```
å„ä¸ªåŠŸèƒ½æ¨¡å— (features/screens/core)  # å·¥å…·ä½¿ç”¨è€…
    â†“ (å·¥å…·è°ƒç”¨)
core/utils/                         # ğŸ”µ å½“å‰å±‚çº§ - å·¥å…·é›†åˆ
    â†“ (åŸºç¡€åŠŸèƒ½)
Flutter SDK + Dartè¯­è¨€ç‰¹æ€§          # åŸºç¡€ä¾èµ–
    â†“ (å¹³å°æœåŠ¡)
iOS/Android/Webå¹³å°                 # å¹³å°é€‚é…
```

### èŒè´£è¾¹ç•Œ
- âœ… **å·¥å…·å‡½æ•°**: æä¾›çº¯å‡½æ•°å’Œé€šç”¨å·¥å…·
- âœ… **è·¨æ¨¡å—å…±äº«**: è¢«å¤šä¸ªæ¨¡å—å…±åŒä½¿ç”¨çš„åŠŸèƒ½
- âœ… **å¹³å°é€‚é…**: å¤„ç†å¹³å°å·®å¼‚å’Œå…¼å®¹æ€§
- âœ… **å¼€å‘è¾…åŠ©**: æå‡å¼€å‘æ•ˆç‡çš„è¾…åŠ©åŠŸèƒ½
- âŒ **ä¸šåŠ¡é€»è¾‘**: ä¸åŒ…å«å…·ä½“çš„ä¸šåŠ¡è§„åˆ™
- âŒ **çŠ¶æ€ç®¡ç†**: ä¸è´Ÿè´£æ•°æ®çŠ¶æ€ç»´æŠ¤

## å·¥å…·åˆ†ç±»

### 1. æ—¥å¿—å’Œè°ƒè¯•å·¥å…· (3ä¸ªæ–‡ä»¶)

#### Logger (`logger.dart`)
**èŒè´£**: ç»“æ„åŒ–æ—¥å¿—è®°å½•ç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**:
- å¤šçº§åˆ«æ—¥å¿—è®°å½• (Debug, Info, Warning, Error)
- ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- æ—¥å¿—è¿‡æ»¤å’Œæœç´¢
- æ€§èƒ½ç›‘æ§é›†æˆ

**å…³è”å…³ç³»**:
- **ä¾èµ–**: Dartçš„`developer`åº“
- **è¢«ä¾èµ–**: æ‰€æœ‰éœ€è¦æ—¥å¿—è®°å½•çš„æ¨¡å—
- **çº§è”å½±å“**: åº”ç”¨çš„è°ƒè¯•å’Œç›‘æ§èƒ½åŠ›

#### FluxLogger (`flux_logger.dart`)
**èŒè´£**: Flux Ledgerä¸“ç”¨è½»é‡æ—¥å¿—æ¡©

**æ ¸å¿ƒåŠŸèƒ½**:
- ä¸šåŠ¡æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—çš„ç»Ÿä¸€æ ¼å¼
- è½»é‡çº§å®ç°ï¼Œé¿å…é‡ä¾èµ–
- åç»­å¯å¹³æ»‘æ›¿æ¢ä¸ºå®Œæ•´æ—¥å¿—ç³»ç»Ÿ

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `logger.dart` (åŸºç¡€æ—¥å¿—åŠŸèƒ½)
- **è¢«ä¾èµ–**: `main_flux.dart` (åº”ç”¨å…¥å£æ—¥å¿—)
- **çº§è”å½±å“**: åº”ç”¨å¯åŠ¨å’Œè¿è¡Œæ—¶çš„æ—¥å¿—è®°å½•

#### DebugModeManager (`debug_mode_manager.dart`)
**èŒè´£**: è°ƒè¯•æ¨¡å¼ç®¡ç†å’Œé…ç½®

**æ ¸å¿ƒåŠŸèƒ½**:
- è°ƒè¯•å¼€å…³ç®¡ç†
- å¼€å‘è€…é€‰é¡¹æ§åˆ¶
- æµ‹è¯•æ•°æ®ç”Ÿæˆ
- æ€§èƒ½ç›‘æ§å¼€å…³

**å…³è”å…³ç³»**:
- **ä¾èµ–**: SharedPreferences (é…ç½®å­˜å‚¨)
- **è¢«ä¾èµ–**: å¼€å‘è€…æ¨¡å¼é¡µé¢
- **çº§è”å½±å“**: å¼€å‘å’Œæµ‹è¯•ä½“éªŒ

### 2. æ•°æ®å¤„ç†å·¥å…· (3ä¸ªæ–‡ä»¶)

#### CurrencyFormatter (`currency_formatter.dart`)
**èŒè´£**: è´§å¸æ ¼å¼åŒ–å’Œæ˜¾ç¤ºå·¥å…·

**æ ¸å¿ƒåŠŸèƒ½**:
- å¤šè´§å¸æ ¼å¼æ”¯æŒ
- æœ¬åœ°åŒ–è´§å¸æ˜¾ç¤º
- é‡‘é¢ç²¾ç¡®è®¡ç®—
- æ±‡ç‡è½¬æ¢è¾…åŠ©

**å…³è”å…³ç³»**:
- **ä¾èµ–**: Dartçš„`intl`åº“
- **è¢«ä¾èµ–**: æ‰€æœ‰é‡‘é¢æ˜¾ç¤ºç»„ä»¶
- **çº§è”å½±å“**: è´¢åŠ¡æ•°æ®çš„æ˜¾ç¤ºä¸€è‡´æ€§

#### AiDateParser (`ai_date_parser.dart`)
**èŒè´£**: AIå¢å¼ºçš„æ—¥æœŸè§£æå·¥å…·

**æ ¸å¿ƒåŠŸèƒ½**:
- è‡ªç„¶è¯­è¨€æ—¥æœŸè§£æ
- ç›¸å¯¹æ—¥æœŸè®¡ç®—
- å¤šæ ¼å¼æ—¥æœŸè¯†åˆ«
- æ—¶åŒºå¤„ç†

**å…³è”å…³ç³»**:
- **ä¾èµ–**: AIæœåŠ¡ (å¯é€‰)
- **è¢«ä¾èµ–**: äº¤æ˜“å½•å…¥å’Œæ—¥æœŸé€‰æ‹©ç»„ä»¶
- **çº§è”å½±å“**: æ—¥æœŸè¾“å…¥çš„ç”¨æˆ·ä½“éªŒ

#### SalaryFormValidators (`salary_form_validators.dart`)
**èŒè´£**: å·¥èµ„è¡¨å•éªŒè¯å·¥å…·

**æ ¸å¿ƒåŠŸèƒ½**:
- å·¥èµ„æ•°æ®æ ¼å¼éªŒè¯
- ä¸šåŠ¡è§„åˆ™æ£€æŸ¥
- é”™è¯¯æç¤ºç”Ÿæˆ
- æ•°æ®å®Œæ•´æ€§éªŒè¯

**å…³è”å…³ç³»**:
- **ä¾èµ–**: å·¥èµ„ç›¸å…³çš„ä¸šåŠ¡è§„åˆ™
- **è¢«ä¾èµ–**: å·¥èµ„è®¾ç½®è¡¨å•
- **çº§è”å½±å“**: å·¥èµ„æ•°æ®å½•å…¥çš„å‡†ç¡®æ€§

### 3. ç”¨æˆ·äº¤äº’å·¥å…· (3ä¸ªæ–‡ä»¶)

#### NotificationManager (`notification_manager.dart`)
**èŒè´£**: é€šçŸ¥ç®¡ç†å’Œè°ƒåº¦ç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**:
- æœ¬åœ°é€šçŸ¥è°ƒåº¦
- é€šçŸ¥æƒé™ç®¡ç†
- é€šçŸ¥æ¨¡æ¿ç®¡ç†
- é€šçŸ¥å†å²è®°å½•

**å…³è”å…³ç³»**:
- **ä¾èµ–**: å¹³å°é€šçŸ¥API
- **è¢«ä¾èµ–**: æé†’å’Œé€šçŸ¥åŠŸèƒ½
- **çº§è”å½±å“**: ç”¨æˆ·æé†’åŠŸèƒ½çš„æœ‰æ•ˆæ€§

#### UnifiedNotifications (`unified_notifications.dart`)
**èŒè´£**: ç»Ÿä¸€é€šçŸ¥ç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**:
- å¤šæ¸ é“é€šçŸ¥é›†æˆ
- é€šçŸ¥ä¼˜å…ˆçº§ç®¡ç†
- é€šçŸ¥å»é‡å’Œåˆå¹¶
- é€šçŸ¥ç»Ÿè®¡åˆ†æ

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `NotificationManager`
- **è¢«ä¾èµ–**: å…¨å±€é€šçŸ¥éœ€æ±‚
- **çº§è”å½±å“**: é€šçŸ¥ç³»ç»Ÿçš„ç»Ÿä¸€æ€§å’Œæ•ˆç‡

#### PerformanceMonitor (`performance_monitor.dart`)
**èŒè´£**: æ€§èƒ½ç›‘æ§å’Œåˆ†æå·¥å…·

**æ ¸å¿ƒåŠŸèƒ½**:
- UIæ¸²æŸ“æ€§èƒ½ç›‘æ§
- å†…å­˜ä½¿ç”¨è·Ÿè¸ª
- æ–¹æ³•æ‰§è¡Œæ—¶é—´æµ‹é‡
- æ€§èƒ½æŒ‡æ ‡æ”¶é›†

**å…³è”å…³ç³»**:
- **ä¾èµ–**: Dartçš„æ€§èƒ½åˆ†æAPI
- **è¢«ä¾èµ–**: æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•
- **çº§è”å½±å“**: åº”ç”¨æ€§èƒ½çš„æŒç»­ä¼˜åŒ–

### 4. éªŒè¯å’Œå¼‚å¸¸å¤„ç† (1ä¸ªæ–‡ä»¶)

#### VerificationExceptions (`verification_exceptions.dart`)
**èŒè´£**: éªŒè¯æ¡†æ¶çš„å¼‚å¸¸å®šä¹‰å’Œå¤„ç†

**æ ¸å¿ƒåŠŸèƒ½**:
- éªŒè¯å¼‚å¸¸ç±»å‹å®šä¹‰
- å¼‚å¸¸å¤„ç†ç­–ç•¥
- é”™è¯¯ä¿¡æ¯æ ¼å¼åŒ–
- å¼‚å¸¸é“¾è¿½è¸ª

**å…³è”å…³ç³»**:
- **ä¾èµ–**: Dartå¼‚å¸¸å¤„ç†æœºåˆ¶
- **è¢«ä¾èµ–**: `verifiers/` éªŒè¯æ¡†æ¶
- **çº§è”å½±å“**: éªŒè¯è¿‡ç¨‹çš„é”™è¯¯å¤„ç†ä¸€è‡´æ€§

## å·¥å…·è®¾è®¡åŸåˆ™

### 1. çº¯å‡½æ•°ä¼˜å…ˆ
å¤§éƒ¨åˆ†å·¥å…·å‡½æ•°è®¾è®¡ä¸ºçº¯å‡½æ•°ï¼Œä¾¿äºæµ‹è¯•å’Œå¤ç”¨ã€‚

### 2. å•ä¾‹æ¨¡å¼
éœ€è¦çŠ¶æ€ç®¡ç†çš„å·¥å…·ç±»ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚

### 3. ä¾èµ–æ³¨å…¥
å·¥å…·ç±»é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•ã€‚

### 4. é”™è¯¯å¤„ç†
å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ä¼ æ’­æœºåˆ¶ã€‚

### 5. å¹³å°é€‚é…
è€ƒè™‘ä¸åŒå¹³å°çš„å·®å¼‚å’Œå…¼å®¹æ€§ã€‚

## å·¥å…·è°ƒç”¨æ¨¡å¼

### é™æ€å·¥å…·æ–¹æ³•
```dart
// è´§å¸æ ¼å¼åŒ–
String formatted = CurrencyFormatter.formatAmount(1234.56, 'CNY');

// æ—¥æœŸè§£æ
DateTime? date = AiDateParser.parseDateString('æ˜å¤©ä¸Šåˆ10ç‚¹');
```

### å•ä¾‹å·¥å…·ç±»
```dart
// æ—¥å¿—è®°å½•
Logger.instance.info('ç”¨æˆ·ç™»å½•', {'userId': '123'});

// æ€§èƒ½ç›‘æ§
PerformanceMonitor.instance.startTiming('data_load');
```

### æ‰©å±•æ–¹æ³•
```dart
// å­—ç¬¦ä¸²æ‰©å±•
extension StringExtensions on String {
  String toCurrency() => CurrencyFormatter.formatAmount(double.parse(this), 'CNY');
}

// æ—¥æœŸæ‰©å±•
extension DateTimeExtensions on DateTime {
  String toRelativeString() => AiDateParser.toRelativeString(this);
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜æœºåˆ¶
å¸¸ç”¨æ•°æ®çš„å†…å­˜ç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚

### 2. æ‡’åŠ è½½
å·¥å…·ç±»çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå‡å°‘åº”ç”¨å¯åŠ¨æ—¶é—´ã€‚

### 3. å¼‚æ­¥å¤„ç†
é•¿æ—¶é—´æ“ä½œçš„å¼‚æ­¥æ‰§è¡Œï¼Œé¿å…UIé˜»å¡ã€‚

### 4. èµ„æºç®¡ç†
åŠæ—¶é‡Šæ”¾èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- çº¯å‡½æ•°çš„è¾“å…¥è¾“å‡ºæµ‹è¯•
- å·¥å…·ç±»çš„åŠŸèƒ½æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æµ‹è¯•

### é›†æˆæµ‹è¯•
- å·¥å…·ä¸å¹³å°çš„é›†æˆæµ‹è¯•
- å¤šå·¥å…·ååŒå·¥ä½œæµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•

### ç«¯åˆ°ç«¯æµ‹è¯•
- å·¥å…·åœ¨å®Œæ•´æµç¨‹ä¸­çš„è¡¨ç°æµ‹è¯•
- ç”¨æˆ·ä½“éªŒç›¸å…³çš„å·¥å…·æµ‹è¯•

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„å·¥å…·ç±»
```dart
class NewUtility {
  static final NewUtility _instance = NewUtility._internal();

  factory NewUtility() => _instance;

  NewUtility._internal();

  ResultType performOperation(InputType input) {
    // å®ç°å·¥å…·é€»è¾‘
  }
}
```

### æ·»åŠ æ‰©å±•æ–¹æ³•
```dart
extension NewExtensions on ExistingType {
  ReturnType newMethod() {
    // å®ç°æ‰©å±•é€»è¾‘
  }
}
```

## ä½¿ç”¨æŒ‡å—

### æ—¥å¿—è®°å½•
```dart
// åŸºç¡€æ—¥å¿—
Logger.instance.info('æ“ä½œæˆåŠŸ', {'details': 'é¢å¤–ä¿¡æ¯'});

// é”™è¯¯æ—¥å¿—
Logger.instance.error('ç½‘ç»œè¯·æ±‚å¤±è´¥', error, stackTrace);

// æ€§èƒ½æ—¥å¿—
PerformanceMonitor.instance.logTiming('api_call', duration);
```

### è´§å¸å¤„ç†
```dart
// æ ¼å¼åŒ–æ˜¾ç¤º
String displayAmount = CurrencyFormatter.formatAmount(1234.56, 'CNY');

// è®¡ç®—å¤„ç†
double result = CurrencyFormatter.calculateTax(10000, 0.03);
```

### é€šçŸ¥ç®¡ç†
```dart
// è°ƒåº¦é€šçŸ¥
await NotificationManager.instance.scheduleNotification(
  title: 'æé†’',
  body: 'è®°å¾—è®°å½•æ”¯å‡º',
  scheduledTime: DateTime.now().add(Duration(hours: 1)),
);
```

## ç›¸å…³æ–‡æ¡£

- [CoreåŒ…æ€»æ–‡æ¡£](../README.md)
- [Loggerä½¿ç”¨æŒ‡å—](logger.dart)
- [æ€§èƒ½ç›‘æ§æœ€ä½³å®è·µ](performance_monitor.dart)


