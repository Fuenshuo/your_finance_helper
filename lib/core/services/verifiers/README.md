# Verification Framework éªŒè¯æ¡†æ¶æ–‡æ¡£

## æ¦‚è¿°

`core/services/verifiers/` æ˜¯Flux Ledgerçš„ç»„ä»¶éªŒè¯å’Œè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶æ ¸å¿ƒï¼Œæä¾›ç³»ç»Ÿæ€§çš„ç»„ä»¶éªŒè¯èƒ½åŠ›ï¼Œç¡®ä¿åº”ç”¨åŠŸèƒ½çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚

**æ–‡ä»¶ç»Ÿè®¡**: 5ä¸ªDartæ–‡ä»¶ï¼Œå®ç°å®Œæ•´çš„éªŒè¯æ¡†æ¶å’Œå…·ä½“éªŒè¯å™¨

## æ¶æ„å®šä½

### å±‚çº§å…³ç³»
```
æµ‹è¯•éœ€æ±‚/éªŒè¯åœºæ™¯                # éªŒè¯è§¦å‘
    â†“ (éªŒè¯æ‰§è¡Œ)
core/services/verifiers/           # ğŸ”µ å½“å‰å±‚çº§ - éªŒè¯æ¡†æ¶
    â†“ (ç»„ä»¶æ£€æŸ¥)
å„ä¸ªåŠŸèƒ½æ¨¡å— (screens/widgets/services) # è¢«éªŒè¯å¯¹è±¡
    â†“ (ç»“æœæ±‡æ€»)
VerificationReport                 # éªŒè¯ç»“æœ
```

### èŒè´£è¾¹ç•Œ
- âœ… **ç»„ä»¶éªŒè¯**: éªŒè¯å„ä¸ªåŠŸèƒ½ç»„ä»¶çš„æ­£ç¡®æ€§
- âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•**: æä¾›å¯å¤ç”¨çš„éªŒè¯æ¡†æ¶
- âœ… **ç»“æœæŠ¥å‘Š**: ç”Ÿæˆè¯¦ç»†çš„éªŒè¯æŠ¥å‘Š
- âœ… **é”™è¯¯è¯Šæ–­**: è¯†åˆ«å’ŒæŠ¥å‘Šç³»ç»Ÿé—®é¢˜
- âŒ **åŠŸèƒ½å®ç°**: ä¸è´Ÿè´£å…·ä½“åŠŸèƒ½çš„å®ç°
- âŒ **UIå±•ç¤º**: ä¸è´Ÿè´£éªŒè¯ç»“æœçš„UIå±•ç¤º

## æ¡†æ¶æ¶æ„

### æ ¸å¿ƒæ¥å£ (2ä¸ªæ–‡ä»¶)

#### ComponentVerifier (`component_verifier.dart`)
**èŒè´£**: å®šä¹‰ç»„ä»¶éªŒè¯å™¨çš„ç»Ÿä¸€æ¥å£å¥‘çº¦

**æ ¸å¿ƒæ¥å£**:
```dart
abstract class ComponentVerifier {
  String get componentName;
  Future<VerificationResult> verify();
}
```

**è®¾è®¡æ¨¡å¼**:
- **ç­–ç•¥æ¨¡å¼**: æ¯ä¸ªå…·ä½“éªŒè¯å™¨å®ç°ä¸åŒçš„éªŒè¯ç­–ç•¥
- **æ¨¡æ¿æ–¹æ³•**: ç»Ÿä¸€çš„éªŒè¯æµç¨‹å’Œç»“æœæ ¼å¼

**å…³è”å…³ç³»**:
- **å®ç°**: è¢«æ‰€æœ‰å…·ä½“éªŒè¯å™¨ç±»å®ç°
- **ä½¿ç”¨**: `VerificationRunner` ç»Ÿä¸€è°ƒç”¨
- **ä¾èµ–**: `VerificationResult` æ¨¡å‹

#### VerificationRunner (`verification_runner.dart`)
**èŒè´£**: éªŒè¯æ¡†æ¶çš„æ ¸å¿ƒè¿è¡Œå™¨ï¼Œç¼–æ’å’Œç®¡ç†æ‰€æœ‰éªŒè¯å™¨

**æ ¸å¿ƒåŠŸèƒ½**:
- éªŒè¯å™¨æ³¨å†Œå’Œç®¡ç†
- æ‰¹é‡éªŒè¯æ‰§è¡Œ
- ç»“æœæ”¶é›†å’Œæ±‡æ€»
- éªŒè¯æµç¨‹æ§åˆ¶

**å…³è”å…³ç³»**:
- **ä¾èµ–**: `ComponentVerifier` æ¥å£
- **è¢«ä¾èµ–**: è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ‰‹åŠ¨éªŒè¯åœºæ™¯
- **çº§è”å½±å“**: æ•´ä¸ªéªŒè¯æ¡†æ¶çš„æ‰§è¡Œæ•ˆç‡

### å…·ä½“éªŒè¯å™¨ (5ä¸ªæ–‡ä»¶)

#### UnifiedTransactionEntryVerifier (`unified_transaction_entry_verifier.dart`)
**èŒè´£**: ç»Ÿä¸€äº¤æ˜“å½•å…¥ç»„ä»¶çš„å®Œæ•´æ€§éªŒè¯

**éªŒè¯èŒƒå›´**:
- å±å¹•æ¸²æŸ“æ­£ç¡®æ€§
- AIè§£æåŠŸèƒ½éªŒè¯
- æ—¶é—´èŒƒå›´æ§ä»¶åŠŸèƒ½
- åŠ¨ç”»æ§åˆ¶å™¨çŠ¶æ€
- ä¸»é¢˜é€‚åº”æ€§æ£€æŸ¥
- è‰ç¨¿äº¤æ˜“ç³»ç»ŸéªŒè¯
- æ—¶é—´çº¿è§†å›¾åŠŸèƒ½
- è§¦è§‰åé¦ˆéªŒè¯

**å…³è”å…³ç³»**:
- **éªŒè¯å¯¹è±¡**: `screens/unified_transaction_entry_screen.dart`
- **ä¾èµ–**: `core/widgets/` (åŠ¨ç”»å’ŒUIç»„ä»¶)
- **ä½¿ç”¨**: è¿ç§»éªŒè¯å’Œå›å½’æµ‹è¯•

#### NavigationVerifier (`navigation_verifier.dart`)
**èŒè´£**: åº”ç”¨å¯¼èˆªç³»ç»Ÿçš„éªŒè¯

**éªŒè¯èŒƒå›´**:
- ä¸»å¯¼èˆªæ æ¸²æŸ“
- è·¯ç”±é…ç½®æ­£ç¡®æ€§
- æ·±å±‚é“¾æ¥å¤„ç†
- é¡µé¢åŠ è½½æ€§èƒ½
- è½¬åœºåŠ¨ç”»æ•ˆæœ
- è¿”å›å¯¼èˆªé€»è¾‘

**å…³è”å…³ç³»**:
- **éªŒè¯å¯¹è±¡**: `core/router/flux_router.dart`
- **ä¾èµ–**: `screens/main_navigation_screen.dart`
- **ä½¿ç”¨**: å¯¼èˆªåŠŸèƒ½æµ‹è¯•

#### ProviderServiceVerifier (`provider_service_verifier.dart`)
**èŒè´£**: çŠ¶æ€ç®¡ç†å’ŒæœåŠ¡çš„éªŒè¯

**éªŒè¯èŒƒå›´**:
- Provideråˆå§‹åŒ–çŠ¶æ€
- çŠ¶æ€ç®¡ç†æ­£ç¡®æ€§
- æ•°æ®æŒä¹…åŒ–éªŒè¯
- ä½™é¢è®¡ç®—å‡†ç¡®æ€§
- é¢„ç®—è·Ÿè¸ªåŠŸèƒ½
- æ”¯å‡ºè®¡åˆ’éªŒè¯
- AIæœåŠ¡é›†æˆ
- ä¸»é¢˜ç®¡ç†åŠŸèƒ½
- æµä½“éªŒProvideréªŒè¯
- æ•°æ®æŒä¹…åŒ–æœºåˆ¶

**å…³è”å…³ç³»**:
- **éªŒè¯å¯¹è±¡**: `core/providers/` ä¸‹çš„æ‰€æœ‰Provider
- **ä¾èµ–**: `core/services/` (ä¸šåŠ¡æœåŠ¡)
- **ä½¿ç”¨**: çŠ¶æ€ç®¡ç†æµ‹è¯•

#### BuildCompilationVerifier (`build_compilation_verifier.dart`)
**èŒè´£**: åº”ç”¨æ„å»ºå’Œç¼–è¯‘çš„éªŒè¯

**éªŒè¯èŒƒå›´**:
- Flutter Doctoræ£€æŸ¥
- ä¾èµ–åŒ…å®Œæ•´æ€§
- ä»£ç åˆ†æé€šè¿‡
- è°ƒè¯•ç‰ˆæœ¬æ„å»º
- è¿è¡Œæ—¶å¯åŠ¨éªŒè¯
- iOSæ„å»ºå…¼å®¹æ€§
- Androidæ„å»ºå…¼å®¹æ€§

**å…³è”å…³ç³»**:
- **éªŒè¯å¯¹è±¡**: æ•´ä¸ªåº”ç”¨æ„å»ºæµç¨‹
- **ä¾èµ–**: Flutter SDKå’Œæ„å»ºå·¥å…·
- **ä½¿ç”¨**: CI/CDé›†æˆå’Œå‘å¸ƒéªŒè¯

#### LegacyArchiveVerifier (`legacy_archive_verifier.dart`)
**èŒè´£**: é—ç•™ä»£ç å½’æ¡£çš„å®Œæ•´æ€§éªŒè¯

**éªŒè¯èŒƒå›´**:
- é—ç•™æ–‡ä»¶å¤¹ç»“æ„å®Œæ•´æ€§
- æ–‡æ¡£è®°å½•å‡†ç¡®æ€§
- Gitè·Ÿè¸ªæ¸…ç†éªŒè¯
- ä»£ç å®Œæ•´æ€§æ£€æŸ¥
- å¯¼å…¥è·¯å¾„æ¸…ç†éªŒè¯
- å½’æ¡£å†…å®¹å®Œæ•´æ€§

**å…³è”å…³ç³»**:
- **éªŒè¯å¯¹è±¡**: ä»£ç æ¸…ç†å’Œå½’æ¡£è¿‡ç¨‹
- **ä¾èµ–**: æ–‡ä»¶ç³»ç»Ÿå’ŒGitçŠ¶æ€
- **ä½¿ç”¨**: ä»£ç é‡æ„éªŒè¯

## éªŒè¯æ‰§è¡Œæµç¨‹

### æ ‡å‡†éªŒè¯æµç¨‹
```
éªŒè¯å™¨æ³¨å†Œ â†’ ç¯å¢ƒå‡†å¤‡ â†’ é€ä¸ªéªŒè¯ â†’ ç»“æœæ”¶é›† â†’ æŠ¥å‘Šç”Ÿæˆ â†’ é—®é¢˜è¯Šæ–­
```

### éªŒè¯ç»“æœå¤„ç†
```dart
class VerificationResult {
  final String componentName;
  final VerificationStatus status;
  final String message;
  final DateTime timestamp;
  final VerificationPriority priority;
  final Duration duration;
}
```

## éªŒè¯ç­–ç•¥

### 1. è‡ªåŠ¨åŒ–éªŒè¯
- **å®šæ—¶æ‰§è¡Œ**: CI/CDä¸­çš„å®šæœŸéªŒè¯
- **è§¦å‘å¼éªŒè¯**: ä»£ç å˜æ›´åçš„è‡ªåŠ¨éªŒè¯
- **æ‰‹åŠ¨éªŒè¯**: å¼€å‘è€…ä¸»åŠ¨æ‰§è¡Œçš„éªŒè¯

### 2. åˆ†å±‚éªŒè¯
- **å•å…ƒéªŒè¯**: å•ä¸ªç»„ä»¶çš„åŠŸèƒ½éªŒè¯
- **é›†æˆéªŒè¯**: ç»„ä»¶é—´çš„åä½œéªŒè¯
- **ç«¯åˆ°ç«¯éªŒè¯**: å®Œæ•´ç”¨æˆ·æµç¨‹éªŒè¯

### 3. æ¸è¿›å¼éªŒè¯
- **åŸºç¡€éªŒè¯**: æ ¸å¿ƒåŠŸèƒ½å¯ç”¨æ€§
- **æ·±åº¦éªŒè¯**: è¯¦ç»†åŠŸèƒ½æ­£ç¡®æ€§
- **æ€§èƒ½éªŒè¯**: ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

## é”™è¯¯å¤„ç†å’ŒæŠ¥å‘Š

### éªŒè¯å¤±è´¥å¤„ç†
- **éé˜»å¡æ‰§è¡Œ**: å•ä¸ªéªŒè¯å™¨å¤±è´¥ä¸å½±å“å…¶ä»–éªŒè¯
- **è¯¦ç»†é”™è¯¯ä¿¡æ¯**: æä¾›å…·ä½“çš„é”™è¯¯åŸå› å’Œä¿®å¤å»ºè®®
- **ä¼˜å…ˆçº§åˆ†ç±»**: æ ¹æ®ä¸¥é‡ç¨‹åº¦åˆ†çº§å¤„ç†

### æŠ¥å‘Šç”Ÿæˆ
- **JSONæ ¼å¼**: ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºç¨‹åºå¤„ç†
- **HTMLæ ¼å¼**: å¯è§†åŒ–æŠ¥å‘Šï¼Œä¾¿äºäººå·¥æŸ¥çœ‹
- **èšåˆåˆ†æ**: è·¨æ—¶é—´æ®µçš„è¶‹åŠ¿åˆ†æ

## æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶è¡Œæ‰§è¡Œ
å¤šä¸ªéªŒè¯å™¨çš„å¹¶å‘æ‰§è¡Œï¼Œæé«˜éªŒè¯æ•ˆç‡ã€‚

### 2. æ™ºèƒ½ç¼“å­˜
éªŒè¯ç»“æœçš„ç¼“å­˜ï¼Œé¿å…é‡å¤éªŒè¯ã€‚

### 3. èµ„æºç®¡ç†
éªŒè¯è¿‡ç¨‹ä¸­çš„å†…å­˜å’Œèµ„æºåˆç†åˆ†é…ã€‚

### 4. è¶…æ—¶æ§åˆ¶
é˜²æ­¢å•ä¸ªéªŒè¯å™¨é•¿æ—¶é—´é˜»å¡æ•´ä¸ªéªŒè¯æµç¨‹ã€‚

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„éªŒè¯å™¨
```dart
class NewFeatureVerifier extends ComponentVerifier {
  @override
  String get componentName => 'NewFeature';

  @override
  Future<VerificationResult> verify() async {
    // å®ç°éªŒè¯é€»è¾‘
    return VerificationResult(
      componentName: componentName,
      status: VerificationStatus.passed,
      message: 'éªŒè¯é€šè¿‡',
      timestamp: DateTime.now(),
    );
  }
}
```

### é›†æˆåˆ°éªŒè¯æ¡†æ¶
```dart
final runner = VerificationRunner();
runner.registerVerifier(NewFeatureVerifier());

// æ‰§è¡ŒéªŒè¯
final results = await runner.runAllVerifications();
```

## æµ‹è¯•ç­–ç•¥

### éªŒè¯å™¨æµ‹è¯•
- éªŒè¯å™¨æœ¬èº«çš„æ­£ç¡®æ€§æµ‹è¯•
- ä¸åŒåœºæ™¯ä¸‹çš„éªŒè¯é€»è¾‘æµ‹è¯•
- é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•

### é›†æˆæµ‹è¯•
- éªŒè¯æ¡†æ¶çš„æ•´ä½“åŠŸèƒ½æµ‹è¯•
- å¤šéªŒè¯å™¨ååŒå·¥ä½œæµ‹è¯•
- æŠ¥å‘Šç”Ÿæˆå’Œå¤„ç†æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- å¤§è§„æ¨¡éªŒè¯çš„æ€§èƒ½è¡¨ç°æµ‹è¯•
- å¹¶å‘éªŒè¯çš„ç¨³å®šæ€§æµ‹è¯•
- èµ„æºä½¿ç”¨ç›‘æ§

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬éªŒè¯æ‰§è¡Œ
```dart
final runner = VerificationRunner([
  UnifiedTransactionEntryVerifier(),
  NavigationVerifier(),
  ProviderServiceVerifier(),
]);

final results = await runner.runAllVerifications();

// æ£€æŸ¥ç»“æœ
for (final result in results) {
  if (result.status == VerificationStatus.failed) {
    print('éªŒè¯å¤±è´¥: ${result.componentName} - ${result.message}');
  }
}
```

### ç‰¹å®šç»„ä»¶éªŒè¯
```dart
final verifier = UnifiedTransactionEntryVerifier();
final result = await verifier.verify();

if (result.status == VerificationStatus.passed) {
  print('äº¤æ˜“å½•å…¥ç»„ä»¶éªŒè¯é€šè¿‡');
}
```

## ç›¸å…³æ–‡æ¡£

- [Core Servicesæ€»æ–‡æ¡£](../README.md)
- [VerificationResultæ¨¡å‹](../../models/verification_result.dart)
- [VerificationRunneræœåŠ¡](../verification_runner.dart)

