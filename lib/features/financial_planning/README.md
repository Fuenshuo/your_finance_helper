# Financial Planning 功能模块文档

## 概述

`financial_planning` 模块是三层架构中的第二层：**财务计划**。它负责管理动态规则配置，包括收入计划、支出计划、预算管理等财务规划功能。

## 模块定位

**核心理念**: 动态规则配置（收入计划、支出计划）

**职责边界**:
- ✅ 制定收入计划（工资计划、投资收益计划）
- ✅ 制定支出计划（周期性支出、预算约束）
- ✅ 管理预算（信封预算、零基预算）
- ✅ 贷款计算（房贷、车贷）
- ✅ 智能预算建议
- ❌ 不涉及静态数据管理（属于family_info）
- ❌ 不涉及实际交易执行（属于transaction_flow）

## 包结构

```
financial_planning/
├── screens/          # 页面界面
├── widgets/          # 专用组件
└── services/         # 专用服务
```

## Screens 页面说明

### 1. financial_planning_home_screen.dart - 财务计划主页

**职责**: 提供财务计划的统一入口

**功能**:
- 模块介绍
- 收入计划列表
- 支出计划列表
- 还款提醒
- 快速创建计划入口

**导航**:
- 创建收入计划 → `create_income_plan_screen.dart`
- 创建支出计划 → `create_expense_plan_screen.dart`
- 预算管理 → `budget_management_screen.dart`
- 还款历史 → `repayment_history_screen.dart`

### 2. create_income_plan_screen.dart - 创建收入计划页面

**职责**: 创建和管理收入计划

**功能**:
- 收入计划类型选择（普通收入、详细工资）
- 计划基本信息设置（名称、描述、金额）
- 收入频率设置（日、周、月、年）
- 计划周期设置（开始日期、结束日期）
- 关联账户设置
- 自动生成交易配置

**计划类型**:
- **普通收入计划**: 简单的周期性收入
- **详细工资计划**: 基于工资收入设置的详细计划

### 3. create_expense_plan_screen.dart - 创建支出计划页面

**职责**: 创建和管理支出计划

**功能**:
- 支出计划类型选择（周期性、预算性）
- 计划基本信息设置（名称、描述、金额）
- 支出频率设置（日、周、月、年）
- 计划周期设置（开始日期、结束日期）
- 关联账户和分类
- 贷款还款计划配置
- 自动生成交易配置

**计划类型**:
- **周期性支出计划**: 定期发生的支出（如房租、水电费）
- **预算性支出计划**: 基于预算的支出控制

### 4. budget_management_screen.dart - 预算管理页面

**职责**: 管理信封预算和零基预算

**功能**:
- 预算总览
- 信封预算列表
- 零基预算列表
- 工资收入管理
- 预算创建和编辑
- 预算详情查看

**标签页**:
- 总览
- 信封预算
- 零基预算
- 工资收入

### 5. envelope_budget_detail_screen.dart - 信封预算详情页面

**职责**: 展示信封预算的详细信息

**功能**:
- 预算基本信息
- 已分配金额和已花费金额
- 预算使用进度
- 关联的交易记录
- 警告阈值和限制阈值
- 预算编辑和删除

### 6. mortgage_calculator_screen.dart - 房贷计算器页面

**职责**: 计算房贷相关信息

**功能**:
- 贷款金额输入
- 贷款利率设置
- 贷款期限设置
- 还款方式选择（等额本息、等额本金）
- 月供计算
- 还款计划表
- 利息总额计算

### 7. repayment_history_screen.dart - 还款历史页面

**职责**: 展示还款历史记录

**功能**:
- 还款记录列表
- 还款金额和日期
- 还款账户信息
- 还款状态（已还、待还）

### 8. smart_budget_guidance_screen.dart - 智能预算引导页面

**职责**: 基于资产类型提供预算建议

**功能**:
- 资产类型分析
- 预算建议展示
- 一键创建预算
- 预算模板推荐

## Services 服务说明

### 1. smart_budget_guidance_service.dart - 智能预算引导服务

**职责**: 基于用户资产提供预算建议

**功能**:
- 分析资产类型
- 生成预算建议
- 推荐预算模板
- 预算金额建议

**建议逻辑**:
- 房产资产 → 推荐房贷预算、物业费预算
- 流动资产 → 推荐投资预算
- 负债资产 → 推荐还款预算
- 消费资产 → 推荐维护预算

## Widgets 组件说明

目前该模块的专用组件较少，主要使用 `core/widgets` 中的通用组件。

## 数据流

### 数据来源
- `core/providers/income_plan_provider.dart` - 收入计划状态管理
- `core/providers/expense_plan_provider.dart` - 支出计划状态管理
- `core/providers/budget_provider.dart` - 预算状态管理
- `core/models/income_plan.dart` - 收入计划模型
- `core/models/expense_plan.dart` - 支出计划模型
- `core/models/budget.dart` - 预算模型

### 数据流向
1. UI层（Screens） → Provider层（状态管理）
2. Provider层 → Service层（业务逻辑）
3. Service层 → Storage/Database层（数据持久化）
4. 计划执行 → Transaction Flow模块（自动生成交易）

## 与其他模块的关系

### 与 Family Info 模块
- **输入**: 工资收入数据用于收入计划
- **输入**: 资产数据用于预算建议
- **输入**: 账户数据用于计划关联

### 与 Transaction Flow 模块
- **输出**: 计划执行时自动生成交易记录
- **输出**: 预算关联交易记录
- **输入**: 交易记录用于预算使用情况统计

## 核心功能

### 1. 收入计划

**普通收入计划**:
- 简单的周期性收入配置
- 支持日、周、月、年频率
- 自动生成收入交易

**详细工资计划**:
- 基于工资收入设置的详细计划
- 包含基本工资、津贴、奖金
- 自动计算个税、社保、公积金
- 支持工资历史记录

### 2. 支出计划

**周期性支出计划**:
- 定期发生的支出（房租、水电费等）
- 支持多种频率配置
- 自动生成支出交易

**预算性支出计划**:
- 基于预算的支出控制
- 关联信封预算或零基预算
- 支持预算警告和限制

### 3. 预算管理

**信封预算**:
- 为特定类别设定支出限额
- 跟踪已花费金额
- 支持警告阈值和限制阈值
- 关联交易记录

**零基预算**:
- 将收入分配到各个类别
- 确保总分配不超过总收入
- 支持多个信封配置

### 4. 贷款计算

**房贷计算**:
- 支持等额本息和等额本金
- 计算月供和利息总额
- 生成还款计划表
- 支持组合贷款计算

## 设计原则

### 1. 规则驱动
通过配置规则实现自动化，减少手动操作。

### 2. 计划模板
提供常用计划模板，降低配置复杂度。

### 3. 智能建议
基于用户资产和消费习惯提供预算建议。

### 4. 自动执行
计划配置后自动生成交易，无需手动记录。

## 使用指南

### 创建收入计划

1. 进入财务计划主页
2. 点击"创建收入计划"
3. 选择计划类型（普通收入或详细工资）
4. 配置计划信息（名称、金额、频率等）
5. 设置关联账户
6. 保存计划

### 创建支出计划

1. 进入财务计划主页
2. 点击"创建支出计划"
3. 选择计划类型（周期性或预算性）
4. 配置计划信息（名称、金额、频率等）
5. 设置关联账户和分类
6. 如果是还款计划，配置贷款账户
7. 保存计划

### 创建预算

1. 进入预算管理页面
2. 选择预算类型（信封预算或零基预算）
3. 配置预算信息（名称、金额、周期等）
4. 设置警告阈值和限制阈值
5. 保存预算

## 相关文档

- [Core包文档](../../core/README.md)
- [Transaction Flow模块文档](../transaction_flow/README.md)
- [项目架构重构总结](../../../项目架构重构总结.md)

