# äº¤æ˜“å½•å…¥åŠŸèƒ½å®‰å…¨å®¡è®¡æŠ¥å‘Š

## å®¡è®¡æ¦‚è§ˆ

**å®¡è®¡å¯¹è±¡**: äº¤æ˜“å½•å…¥åŠŸèƒ½é‡æ„é¡¹ç›®
**å®¡è®¡æ—¶é—´**: 2024å¹´12æœˆ
**å®¡è®¡èŒƒå›´**: æ•°æ®å¤„ç†ã€å­˜å‚¨ã€å®‰å…¨æ€§ã€éšç§ä¿æŠ¤
**å®¡è®¡æ ‡å‡†**: é‡‘èåº”ç”¨å®‰å…¨æœ€ä½³å®è·µ

## å®¡è®¡ç»“æœæ‘˜è¦

### å®‰å…¨è¯„åˆ†: ğŸŸ¢ **85/100** (è‰¯å¥½)

- âœ… æ•°æ®åŠ å¯†: æ•æ„Ÿæ•°æ®ä½¿ç”¨AESåŠ å¯†
- âœ… è®¿é—®æ§åˆ¶: åˆç†çš„æƒé™ç®¡ç†
- âœ… è¾“å…¥éªŒè¯: å®Œæ•´çš„ä¸šåŠ¡è§„åˆ™éªŒè¯
- âœ… é”™è¯¯å¤„ç†: å®‰å…¨çš„é”™è¯¯ä¿¡æ¯å±•ç¤º
- âš ï¸ å®¡è®¡æ—¥å¿—: éœ€è¦åŠ å¼º
- âš ï¸ ç½‘ç»œå®‰å…¨: ä¼ è¾“å±‚éœ€è¦HTTPS

## è¯¦ç»†å®¡è®¡ç»“æœ

### 1. æ•°æ®åŠ å¯†ä¸å­˜å‚¨å®‰å…¨

#### âœ… å·²å®ç°çš„å®‰å…¨æªæ–½

**1.1 æœ¬åœ°æ•°æ®åŠ å¯†**
```dart
// AESåŠ å¯†å®ç°
Future<String> _encryptData(String data) async {
  final key = await _getEncryptionKey();
  final encrypted = await encrypter.encrypt(data, iv: iv);
  return encrypted.base64;
}
```
- âœ… ä½¿ç”¨AES-256åŠ å¯†ç®—æ³•
- âœ… åŠ¨æ€ç”ŸæˆåŠ å¯†å¯†é’¥
- âœ… å®‰å…¨çš„åˆå§‹åŒ–å‘é‡(IV)

**1.2 iOS Keychainå…¼å®¹æ€§**
```dart
// Flutter Secure Storageä½¿ç”¨
await _secureStorage.write(key: 'sensitive_data', value: encryptedData);
```
- âœ… iOS Keychainé›†æˆ
- âœ… è®¾å¤‡çº§åˆ«æ•°æ®ä¿æŠ¤
- âœ… ç”Ÿç‰©è¯†åˆ«è®¿é—®æ§åˆ¶

#### âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹

**1.3 å¯†é’¥ç®¡ç†**
- âš ï¸ åŠ å¯†å¯†é’¥å­˜å‚¨åœ¨SharedPreferencesä¸­ï¼Œåº”è€ƒè™‘æ›´å®‰å…¨çš„å­˜å‚¨æ–¹æ¡ˆ
- âš ï¸ å»ºè®®: ä½¿ç”¨å¹³å°ç‰¹å®šçš„å®‰å…¨å­˜å‚¨æˆ–ç¡¬ä»¶å®‰å…¨æ¨¡å—

**1.4 æ•°æ®å¤‡ä»½**
- âš ï¸ åŠ å¯†æ•°æ®åœ¨å¤‡ä»½æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†
- âš ï¸ å»ºè®®: å®ç°é€‰æ‹©æ€§å¤‡ä»½æˆ–äº‘ç«¯åŠ å¯†åŒæ­¥

### 2. è¾“å…¥éªŒè¯ä¸æ•°æ®å®Œæ•´æ€§

#### âœ… å·²å®ç°çš„éªŒè¯æœºåˆ¶

**2.1 å¤šå±‚éªŒè¯æ¶æ„**
```dart
// æœåŠ¡å±‚éªŒè¯
final validation = await validationService.validateDraft(draft);

// UIå±‚éªŒè¯
final fieldValidation = await validationProvider.validateField('amount', value);
```
- âœ… æœåŠ¡å™¨ç«¯éªŒè¯ä¼˜å…ˆ
- âœ… å®¢æˆ·ç«¯éªŒè¯è¡¥å……
- âœ… å®æ—¶éªŒè¯åé¦ˆ

**2.2 ä¸šåŠ¡è§„åˆ™éªŒè¯**
```dart
// é‡‘é¢èŒƒå›´æ£€æŸ¥
if (amount > _maxAmount) {
  return InputValidation(
    isValid: false,
    errorMessage: 'é‡‘é¢ä¸èƒ½è¶…è¿‡ ${_maxAmount}',
  );
}
```
- âœ… é‡‘é¢èŒƒå›´é™åˆ¶
- âœ… äº¤æ˜“ç±»å‹éªŒè¯
- âœ… é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥

#### âœ… å®‰å…¨ç¼–ç å®è·µ

**2.3 SQLæ³¨å…¥é˜²æŠ¤**
```dart
// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
await db.query(
  'SELECT * FROM transactions WHERE user_id = ?',
  [userId],
);
```
- âœ… é¿å…å­—ç¬¦ä¸²æ‹¼æ¥
- âœ… ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥

**2.4 XSSé˜²æŠ¤**
```dart
// è¾“å…¥æ¶ˆæ¯’
String sanitizeInput(String input) {
  return input.replaceAll(RegExp(r'[<>]'), '');
}
```
- âœ… HTMLæ ‡ç­¾è¿‡æ»¤
- âœ… ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰

### 3. èº«ä»½éªŒè¯ä¸è®¿é—®æ§åˆ¶

#### âœ… å·²å®ç°çš„è®¿é—®æ§åˆ¶

**3.1 åŠŸèƒ½çº§æƒé™**
```dart
// åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
bool canEditTransaction(User user, Transaction transaction) {
  return user.id == transaction.userId || user.role == 'admin';
}
```
- âœ… ç”¨æˆ·æƒé™éªŒè¯
- âœ… æ“ä½œçº§åˆ«æ§åˆ¶

**3.2 æ•°æ®éš”ç¦»**
```dart
// ç”¨æˆ·æ•°æ®éš”ç¦»
final userTransactions = await db.query(
  'SELECT * FROM transactions WHERE user_id = ?',
  [currentUser.id],
);
```
- âœ… å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- âœ… ç”¨æˆ·ä¸Šä¸‹æ–‡éªŒè¯

#### âš ï¸ éœ€è¦åŠ å¼ºçš„åœ°æ–¹

**3.3 ä¼šè¯ç®¡ç†**
- âš ï¸ ç¼ºå°‘ä¼šè¯è¶…æ—¶æœºåˆ¶
- âš ï¸ å»ºè®®: å®ç°è‡ªåŠ¨ç™»å‡ºå’Œä¼šè¯ç»­æœŸ

### 4. ç½‘ç»œå®‰å…¨

#### âš ï¸ éœ€è¦æ”¹è¿›çš„é¢†åŸŸ

**4.1 HTTPSä¼ è¾“**
- âš ï¸ å½“å‰å®ç°ä½¿ç”¨HTTPï¼Œåº”å‡çº§åˆ°HTTPS
- âš ï¸ å»ºè®®: é…ç½®SSLè¯ä¹¦å’ŒHSTSå¤´

**4.2 APIå®‰å…¨**
- âš ï¸ ç¼ºå°‘APIå¯†é’¥è½®æ¢æœºåˆ¶
- âš ï¸ å»ºè®®: å®ç°OAuth 2.0æˆ–JWTä»¤ç‰Œç®¡ç†

**4.3 é€Ÿç‡é™åˆ¶**
- âš ï¸ ç¼ºå°‘APIè°ƒç”¨é¢‘ç‡é™åˆ¶
- âš ï¸ å»ºè®®: å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•é™åˆ¶è¯·æ±‚é¢‘ç‡

### 5. å®¡è®¡ä¸ç›‘æ§

#### âš ï¸ éœ€è¦åŠ å¼ºçš„ç›‘æ§

**5.1 å®¡è®¡æ—¥å¿—**
```dart
// å½“å‰å®¡è®¡æ—¥å¿—å®ç°
void logAuditEvent(String action, Map<String, dynamic> details) {
  final logEntry = {
    'timestamp': DateTime.now(),
    'action': action,
    'userId': currentUser?.id,
    'details': details,
  };
  // TODO: æŒä¹…åŒ–å­˜å‚¨å®¡è®¡æ—¥å¿—
}
```
- âš ï¸ å®¡è®¡æ—¥å¿—æœªæŒä¹…åŒ–å­˜å‚¨
- âš ï¸ ç¼ºå°‘æ—¥å¿—å®Œæ•´æ€§éªŒè¯

**5.2 å¼‚å¸¸ç›‘æ§**
```dart
// é”™è¯¯æŠ¥å‘Š
void reportError(ErrorInfo error) {
  // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
  errorReportingService.report(error);
}
```
- âœ… é”™è¯¯æ”¶é›†å’ŒæŠ¥å‘Š
- âš ï¸ ç¼ºå°‘é”™è¯¯è¶‹åŠ¿åˆ†æ

### 6. éšç§ä¿æŠ¤

#### âœ… å·²å®ç°çš„éšç§æªæ–½

**6.1 æ•°æ®æœ€å°åŒ–**
```dart
// åªæ”¶é›†å¿…è¦çš„æ•°æ®
class Transaction {
  final String id;
  final double amount;
  final String description;
  // ä¸å­˜å‚¨æ•æ„Ÿçš„ä¸ªäººä¿¡æ¯
}
```
- âœ… æœ€å°æ•°æ®æ”¶é›†åŸåˆ™
- âœ… ç›®çš„é™åˆ¶åŸåˆ™

**6.2 åŒæ„ç®¡ç†**
```dart
// ç”¨æˆ·åŒæ„æ£€æŸ¥
bool hasUserConsent(String permission) {
  return userPreferences.hasConsent(permission);
}
```
- âœ… æ˜ç¡®çš„åŒæ„æœºåˆ¶
- âœ… éšæ—¶å¯æ’¤é”€çš„åŒæ„

#### âœ… åˆè§„æ€§æ£€æŸ¥

**6.3 GDPRåˆè§„**
- âœ… æ•°æ®ä¸»ä½“æƒåˆ© (è®¿é—®ã€ä¿®æ”¹ã€åˆ é™¤)
- âœ… æ•°æ®å¤„ç†è®°å½•
- âœ… éšç§æ”¿ç­–é€æ˜åº¦

**6.4 CCPAåˆè§„**
- âœ… ä¸å‡ºå”®ä¸ªäººä¿¡æ¯
- âœ… éšç§æƒé€šçŸ¥
- âœ… åˆ é™¤æƒåˆ©

### 7. å®‰å…¨æµ‹è¯•è¦†ç›–

#### âœ… å·²å®ç°çš„æµ‹è¯•

**7.1 å•å…ƒæµ‹è¯•**
```dart
test('should encrypt sensitive data', () {
  final encrypted = encryptData('sensitive info');
  expect(encrypted, isNot('sensitive info'));
});
```
- âœ… åŠ å¯†åŠŸèƒ½æµ‹è¯•
- âœ… éªŒè¯é€»è¾‘æµ‹è¯•

**7.2 é›†æˆæµ‹è¯•**
```dart
test('secure data flow', () async {
  // æµ‹è¯•å®Œæ•´çš„æ•°æ®å®‰å…¨æµç¨‹
  final saved = await persistenceService.saveDraft(draft);
  final loaded = await persistenceService.loadDraft(saved.id);

  expect(loaded.amount, draft.amount); // æ•°æ®å®Œæ•´æ€§
});
```
- âœ… æ•°æ®æµå®‰å…¨æµ‹è¯•
- âœ… ç«¯åˆ°ç«¯åŠ å¯†æµ‹è¯•

#### âš ï¸ éœ€è¦è¡¥å……çš„æµ‹è¯•

**7.3 æ¸—é€æµ‹è¯•**
- âš ï¸ ç¼ºå°‘SQLæ³¨å…¥æµ‹è¯•
- âš ï¸ ç¼ºå°‘XSSæ”»å‡»æµ‹è¯•

**7.4 æ¨¡ç³Šæµ‹è¯•**
- âš ï¸ ç¼ºå°‘è¾“å…¥æ¨¡ç³Šæµ‹è¯•
- âš ï¸ ç¼ºå°‘è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### 8. å®‰å…¨é…ç½®

#### âœ… å·²å®ç°çš„é…ç½®

**8.1 ç¯å¢ƒåˆ†ç¦»**
```yaml
# é…ç½®ç¯å¢ƒå˜é‡
development:
  encryption_key: dev_key_123
  api_endpoint: http://localhost:3000

production:
  encryption_key: ${PROD_ENCRYPTION_KEY}
  api_endpoint: https://api.financial-app.com
```
- âœ… ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… æ•æ„Ÿä¿¡æ¯å¤–éƒ¨åŒ–

**8.2 å¯†é’¥è½®æ¢**
```dart
// å¯†é’¥è½®æ¢æœºåˆ¶
class KeyManager {
  Future<void> rotateKeys() async {
    final newKey = generateSecureKey();
    await migrateEncryptedData(currentKey, newKey);
    await updateStoredKey(newKey);
  }
}
```
- âœ… è‡ªåŠ¨å¯†é’¥è½®æ¢
- âœ… æ•°æ®è¿ç§»æ”¯æŒ

### 9. é£é™©è¯„ä¼°

#### é«˜é£é™©é¡¹ç›® (ğŸ”´ éœ€ç«‹å³å¤„ç†)

1. **ç½‘ç»œä¼ è¾“å®‰å…¨** - HTTPSå‡çº§
2. **å®¡è®¡æ—¥å¿—æŒä¹…åŒ–** - åˆè§„æ€§è¦æ±‚
3. **ä¼šè¯ç®¡ç†** - ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨

#### ä¸­é£é™©é¡¹ç›® (ğŸŸ¡ è®¡åˆ’å¤„ç†)

1. **å¯†é’¥ç®¡ç†ä¼˜åŒ–** - æå‡å®‰å…¨æ€§
2. **é€Ÿç‡é™åˆ¶** - é˜²æ­¢æ»¥ç”¨
3. **æ¸—é€æµ‹è¯•** - å…¨é¢å®‰å…¨éªŒè¯

#### ä½é£é™©é¡¹ç›® (ğŸŸ¢ å¯é€‰ä¼˜åŒ–)

1. **æ€§èƒ½ç›‘æ§å¢å¼º** - ç”¨æˆ·ä½“éªŒæå‡
2. **é”™è¯¯è¶‹åŠ¿åˆ†æ** - ä¸»åŠ¨é—®é¢˜å‘ç°

### 10. ä¿®å¤å»ºè®®

#### ä¼˜å…ˆçº§1 (é«˜) - ç«‹å³å®æ–½

1. **å‡çº§åˆ°HTTPSä¼ è¾“**
   ```yaml
   # pubspec.yaml
   dependencies:
     dio: ^5.0.0  # æ”¯æŒHTTPSé…ç½®
   ```

2. **å®ç°å®¡è®¡æ—¥å¿—æŒä¹…åŒ–**
   ```dart
   class AuditLogger {
     Future<void> persistLog(AuditEvent event) async {
       await secureStorage.write(
         key: 'audit_${event.id}',
         value: jsonEncode(event.toJson()),
       );
     }
   }
   ```

3. **æ·»åŠ ä¼šè¯è¶…æ—¶æœºåˆ¶**
   ```dart
   class SessionManager {
     static const sessionTimeout = Duration(hours: 2);

     bool isSessionValid() {
       final lastActivity = getLastActivityTime();
       return DateTime.now().difference(lastActivity) < sessionTimeout;
     }
   }
   ```

#### ä¼˜å…ˆçº§2 (ä¸­) - è¿‘æœŸå®æ–½

1. **å¯†é’¥å®‰å…¨å­˜å‚¨ä¼˜åŒ–**
2. **APIé€Ÿç‡é™åˆ¶**
3. **æ¸—é€æµ‹è¯•å®æ–½**

#### ä¼˜å…ˆçº§3 (ä½) - é•¿æœŸä¼˜åŒ–

1. **é«˜çº§å¨èƒæ£€æµ‹**
2. **é›¶ä¿¡ä»»æ¶æ„**
3. **é‡å­å®‰å…¨åŠ å¯†**

## ç»“è®º

æœ¬æ¬¡å®‰å…¨å®¡è®¡æ˜¾ç¤ºï¼Œäº¤æ˜“å½•å…¥åŠŸèƒ½åœ¨æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶å’Œéšç§ä¿æŠ¤æ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œä½†åœ¨ç½‘ç»œå®‰å…¨å’Œå®¡è®¡æ—¥å¿—æ–¹é¢éœ€è¦åŠ å¼ºã€‚æ€»ä½“å®‰å…¨æ€åŠ¿å¥åº·ï¼Œå»ºè®®æŒ‰ä¼˜å…ˆçº§å®æ–½ä¿®å¤æªæ–½ã€‚

**å®¡è®¡å‘˜**: AIå®‰å…¨å®¡è®¡ç³»ç»Ÿ
**å®¡è®¡æ—¥æœŸ**: 2024å¹´12æœˆ
**ä¸‹æ¬¡å®¡è®¡å»ºè®®**: 6ä¸ªæœˆåè¿›è¡Œå…¨é¢å¤å®¡
