# AI智能记账UI优化方案

## 问题分析

当前有两个独立的拍照识别功能：
1. **发票识别** - 单笔交易识别
2. **银行账单识别** - 批量交易识别

虽然功能相似，但UI分离，用户体验不够统一。

## 优化目标

- 统一UI入口和流程
- 简化用户选择
- 保持功能完整性
- 提升用户体验

## 优化方案

### 方案：统一拍照识别入口 + 智能类型选择

#### UI流程设计

```
AI智能记账对话框
├── 模式选择（顶部）
│   ├── 语音输入
│   └── 拍照识别（统一入口）
│
└── 拍照识别组件（统一）
    ├── 类型选择（首次显示）
    │   ├── 单笔交易（发票/收据）
    │   └── 批量交易（银行账单）
    │
    ├── 拍照/选择图片
    │   ├── 相册选择
    │   └── 拍照
    │
    ├── 识别中状态
    │   └── 加载指示器 + 提示文字
    │
    └── 识别结果
        ├── 单笔交易结果
        │   └── 直接填充表单
        │
        └── 批量交易结果
            ├── 交易列表（可多选）
            ├── 汇总信息
            └── 批量导入按钮
```

#### 详细设计

**1. 统一拍照识别组件**

创建一个新的 `UnifiedImageRecognitionWidget`，整合两个功能：

```dart
class UnifiedImageRecognitionWidget extends StatefulWidget {
  // 支持两种模式：
  // - singleTransaction: 单笔交易（发票/收据）
  // - batchTransactions: 批量交易（银行账单）
  // - auto: 自动识别（默认）
  
  final RecognitionMode mode;
}

enum RecognitionMode {
  singleTransaction,  // 单笔交易
  batchTransactions,  // 批量交易
  auto,               // 自动识别
}
```

**2. 类型选择界面（首次显示）**

如果模式是 `auto`，显示类型选择卡片：

```
┌─────────────────────────────┐
│  选择识别类型                │
├─────────────────────────────┤
│  ┌──────────┐  ┌──────────┐ │
│  │ 📄 单笔  │  │ 📋 批量  │ │
│  │ 发票/收据│  │ 银行账单 │ │
│  │          │  │          │ │
│  │ 识别单张 │  │ 批量导入 │ │
│  │ 交易凭证 │  │ 多笔交易 │ │
│  └──────────┘  └──────────┘ │
└─────────────────────────────┘
```

**3. 统一的拍照界面**

选择类型后，显示统一的拍照界面：

```
┌─────────────────────────────┐
│  📷 拍照识别                 │
├─────────────────────────────┤
│  ┌──────────┐  ┌──────────┐ │
│  │ 📷 拍照  │  │ 🖼️ 相册  │ │
│  └──────────┘  └──────────┘ │
└─────────────────────────────┘
```

**4. 统一的识别结果展示**

- **单笔交易**：显示识别结果卡片，直接填充表单
- **批量交易**：显示交易列表，支持多选导入

**5. 智能识别（可选增强）**

如果选择 `auto` 模式：
- 先识别图片类型（发票 vs 账单）
- 根据识别结果自动选择处理方式
- 如果无法确定，让用户选择

## 实现步骤

### Step 1: 创建统一组件
- 创建 `UnifiedImageRecognitionWidget`
- 整合两个识别服务的调用逻辑

### Step 2: 更新AI智能记账对话框
- 移除独立的"银行账单"模式
- 将"拍照识别"改为统一入口
- 更新模式选择UI（2个选项：语音输入、拍照识别）

### Step 3: 优化用户体验
- 添加类型选择界面
- 统一识别流程
- 优化结果展示

## UI对比

### 优化前
```
AI智能记账
├── 语音输入
├── 拍照识别（发票）
└── 银行账单（批量）
```

### 优化后
```
AI智能记账
├── 语音输入
└── 拍照识别（统一）
    ├── 选择类型（首次）
    ├── 拍照/选择图片
    ├── 识别中
    └── 显示结果
```

## 优势

1. **统一体验**：所有拍照识别功能在一个入口
2. **清晰流程**：用户明确知道每一步在做什么
3. **灵活选择**：支持单笔和批量两种模式
4. **代码复用**：减少重复代码，统一维护

## 技术实现要点

1. **组件结构**：
   - `UnifiedImageRecognitionWidget` - 主组件
   - `RecognitionTypeSelector` - 类型选择子组件
   - `ImageCaptureSection` - 拍照选择子组件
   - `RecognitionResultSection` - 结果展示子组件

2. **状态管理**：
   - `RecognitionMode` - 识别模式
   - `RecognitionState` - 识别状态（idle, selecting, capturing, recognizing, result）

3. **服务调用**：
   - 根据模式调用对应的服务
   - 统一错误处理
   - 统一加载状态

## 后续优化方向

1. **智能识别**：AI自动判断图片类型
2. **历史记录**：记住用户常用类型
3. **快捷入口**：常用类型一键直达

