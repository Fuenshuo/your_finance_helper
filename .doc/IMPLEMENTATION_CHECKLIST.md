# 统一记账入口 - 实施检查清单

## 🎯 实施目标

**完成AI-native统一记账入口的MVP开发，实现"零认知负担"的记账体验**

---

## 📋 开发前准备

### 1. 技术方案对齐

- [ ] 技术方案文档已评审（`.doc/AI_NATIVE_INCOME_SYSTEM_DESIGN.md`）
- [ ] 交互原型文档已评审（`.doc/UNIFIED_TRANSACTION_ENTRY_UX_DESIGN.md`）
- [ ] 埋点事件清单已对齐（`.doc/ANALYTICS_EVENTS_CHECKLIST.md`）
- [ ] 团队对"生活化表达"原则达成共识

### 2. 接口定义

- [ ] NaturalLanguageTransactionService 扩展接口已定义
- [ ] UserIncomeProfile 数据结构已定义
- [ ] metadata.aiExtracted schema 已定义
- [ ] 置信度阈值配置已明确（冷启动策略）

### 3. 设计资源

- [ ] UI组件规范已对齐（Toast、快速确认条、降级弹窗）
- [ ] 动效规范已对齐（轮播问句、呼吸动画、淡入淡出）
- [ ] 图标资源已准备（↗️、×等）

---

## 🚀 Phase 1: 核心功能（MVP）

### 1.1 服务层开发

#### NaturalLanguageTransactionService 扩展

- [ ] 扩展 `parseTransaction` 方法，支持收支自动识别
- [ ] 实现置信度路由逻辑（动态阈值）
- [ ] 实现冷启动策略（前5笔记录更严格阈值）
- [ ] 实现转账类型识别和方向判断
- [ ] 实现模糊输入处理（uncertainty字段）
- [ ] 实现用户画像增强置信度逻辑

#### UserIncomeProfile 实现

- [ ] 创建 UserIncomeProfile 数据结构
- [ ] 实现 `updateFromTransaction` 方法
- [ ] 实现 `enhanceConfidence` 方法
- [ ] 实现 `isColdStart` 方法
- [ ] 实现默认方向推荐（转账场景）

#### metadata.aiExtracted Schema

- [ ] 定义 AiExtracted 接口（grossAmount、socialInsurance等）
- [ ] 实现序列化/反序列化
- [ ] 前端展示逻辑（记录详情页）

### 1.2 UI层开发

#### 主入口组件

- [ ] 统一输入框组件
- [ ] Placeholder 轮播问句（3秒淡入淡出切换）
  - "刚发工资了？"
  - "又买奶茶啦？"
  - "朋友转你钱了？"
  - "今天花了多少？"
- [ ] 多模态入口按钮（拍照、语音、粘贴）
- [ ] 快速入口按钮（A/B测试版本A/B）

#### Toast反馈组件

- [ ] Toast组件（顶部居中）
- [ ] 收入Toast："🎉 工资到账 ¥12,000！"
- [ ] 支出Toast："✅ 已记录：奶茶 ¥28"
- [ ] "(点击可修改 ↗️)" 动效提示
  - 文字末尾加 `↗️` 图标
  - 或轻微呼吸动画（0.5s循环）
- [ ] Toast点击跳转快速编辑页

#### 快速确认条组件

- [ ] 底部弹出确认条
- [ ] **明确采纳方案B**：增加 [×] 关闭按钮，移除自动消失
- [ ] 场景化标签：
  - "[我的工资] [年终奖] [朋友转账] [其他]"
  - "[打车] [吃饭] [购物] [其他]"
- [ ] 点击任意选项立即保存

#### 降级补全界面

- [ ] 模态弹窗组件
- [ ] 生活化标题："发工资啦！多少钱？"
- [ ] 场景化标签选择器
- [ ] 示例按钮动态生成（基于UserIncomeProfile）
- [ ] 金额输入框（必填高亮）

#### 转账确认界面

- [ ] 转账确认弹窗
- [ ] 场景化方向选项：
  - "[我转给朋友]"
  - "[朋友转给我]"
  - "[银行卡间转账]"
- [ ] **默认方向**（基于用户历史）
- [ ] 明确提示："银行卡转账不计入预算统计"

#### 快速编辑页面

- [ ] 极简编辑界面
- [ ] 生活化标题："改一下"
- [ ] 场景化标签选择器
- [ ] 金额、类型、日期编辑
- [ ] 删除功能

#### 去重提示界面

- [ ] 去重检测逻辑
- [ ] 去重提示弹窗
- [ ] **明确合并行为**：
  - 合并后金额 = 原金额 + 新金额
  - 备注自动添加："+ ¥12,000"
  - 保留原记录时间
- [ ] 三个选项：[再记一笔] [合并到这条] [取消]

#### 最近记录入口

- [ ] 长按输入框呼出最近记录
- [ ] 显示最近3笔记录
- [ ] 点击记录跳转快速编辑页

### 1.3 数据层开发

- [ ] Transaction 模型 metadata 字段支持
- [ ] metadata.aiExtracted 序列化/反序列化
- [ ] UserIncomeProfile 存储（SharedPreferences或数据库）
- [ ] 去重检测逻辑（相同金额+日期±1天+类型）

### 1.4 错误处理

- [ ] AI解析超时处理（>2s显示loading）
- [ ] AI解析失败降级处理
- [ ] 网络错误处理
- [ ] 数据验证错误处理

---

## 🧪 Phase 2: 多模态支持

### 2.1 文本粘贴

- [ ] 粘贴功能实现
- [ ] 文本预处理（去除换行、空格等）
- [ ] 支持银行短信、微信、邮件格式

### 2.2 工资条图片OCR

- [ ] 图片选择功能
- [ ] 多模态OCR调用（Qwen-VL）
- [ ] 工资条格式识别
- [ ] OCR结果解析和结构化

### 2.3 语音输入

- [ ] 语音录制功能
- [ ] 语音转文本（STT）
- [ ] 转文本后走文本流程

---

## 📊 Phase 3: 智能学习

### 3.1 UserIncomeProfile 完善

- [ ] 从Transaction历史学习模式
- [ ] 更新平均月收入
- [ ] 更新发薪日模式
- [ ] 更新常见收入类型
- [ ] 更新转账方向偏好

### 3.2 置信度增强

- [ ] 基于用户画像提升置信度
- [ ] 模式匹配（发薪日、金额范围等）
- [ ] 动态阈值调整

### 3.3 收入预测服务

- [ ] IncomePredictionService 实现
- [ ] 基于历史数据 + 用户画像预测
- [ ] 按月统计（初期不必实时）

---

## 🔄 Phase 4: 迁移和清理

### 4.1 数据迁移

- [ ] SalaryIncome → Transaction 转换脚本
- [ ] 保留原始数据备份
- [ ] 迁移数据验证

### 4.2 删除旧功能

- [ ] 删除 SalaryIncomeSetupScreen
- [ ] 删除工资配置相关Widgets
- [ ] 删除工资预览和计算服务
- [ ] 更新路由配置

### 4.3 预算系统集成

- [ ] BudgetProvider 改为从Transaction统计
- [ ] 收入预测改为基于Transaction历史
- [ ] 测试预算计算准确性

---

## 🧪 测试清单

### 功能测试

- [ ] 统一输入框正常显示和输入
- [ ] Placeholder轮播问句正常切换
- [ ] AI解析正常（高/中/低置信度）
- [ ] Toast反馈正常显示和点击
- [ ] 快速确认条正常显示和选择
- [ ] 降级补全界面正常显示和保存
- [ ] 转账确认界面正常显示和选择
- [ ] 快速编辑页面正常编辑和删除
- [ ] 去重检测正常触发和合并
- [ ] 最近记录入口正常呼出和编辑

### 边界测试

- [ ] 模糊输入处理（"发钱了"、"一万二"）
- [ ] 转账方向识别（"转账5000"）
- [ ] 去重逻辑（相同金额+日期±1天）
- [ ] 冷启动策略（前5笔记录）
- [ ] AI解析超时（>2s）
- [ ] 网络错误处理
- [ ] 数据验证错误处理

### 性能测试

- [ ] AI解析延迟 <2s
- [ ] Toast反馈 <100ms
- [ ] 快速编辑页面打开 <300ms
- [ ] 无卡顿、无闪烁

### 用户体验测试

- [ ] 文案符合"生活化表达"原则
- [ ] 场景化标签清晰易懂
- [ ] 动效流畅自然
- [ ] 错误恢复机制友好

---

## 📊 埋点实施

### 埋点开发

- [ ] 埋点SDK集成（Firebase Analytics/Mixpanel等）
- [ ] 所有关键事件已埋点（参考`.doc/ANALYTICS_EVENTS_CHECKLIST.md`）
- [ ] 事件属性完整且正确
- [ ] 数据上报延迟测试（<100ms）

### 数据看板

- [ ] 整体转化漏斗看板
- [ ] 流程分布看板
- [ ] 修正操作分析看板
- [ ] A/B测试结果看板
- [ ] 错误率监控看板

---

## 🧪 A/B测试准备

### 快速入口A/B测试

- [ ] A/B测试框架集成
- [ ] 版本A：显示快速入口
- [ ] 版本B：隐藏快速入口
- [ ] 埋点观察指标：
  - 快速入口使用率
  - 留存率对比
  - 用户满意度对比

---

## ✅ 上线前检查

### 代码质量

- [ ] 代码审查完成
- [ ] 单元测试覆盖率 >80%
- [ ] 集成测试通过
- [ ] 性能测试通过

### 文档完善

- [ ] API文档更新
- [ ] 用户手册更新（如需要）
- [ ] 开发文档更新

### 安全合规

- [ ] 隐私合规检查（不收集敏感信息）
- [ ] 数据加密检查
- [ ] 权限申请检查

### 发布准备

- [ ] 版本号更新
- [ ] 发布说明准备
- [ ] 回滚方案准备

---

## 🚀 上线后监控

### 数据监控

- [ ] 关键指标监控告警
- [ ] 异常数据排查机制
- [ ] 定期数据报告（周报/月报）

### 用户反馈

- [ ] 用户反馈收集渠道
- [ ] 反馈处理流程
- [ ] 快速迭代计划

---

## 📝 开发注意事项

### 关键决策点

1. **快速确认条**：明确采纳方案B（增加关闭按钮，移除自动消失）
2. **转账默认方向**：基于用户历史推荐
3. **合并行为**：明确为金额累加 + 备注添加
4. **Placeholder轮播**：3秒淡入淡出切换
5. **Toast动效**："(点击可修改 ↗️)" 加图标或呼吸动画

### 开发优先级

1. **P0（必须）**：核心功能（Phase 1）
2. **P1（重要）**：文本粘贴、工资条OCR
3. **P2（可选）**：语音输入、智能学习、收入预测

---

**文档版本**：v1.0  
**创建时间**：2025-01-20  
**最后更新**：2025-01-20

