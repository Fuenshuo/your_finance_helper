# AI功能产品设计文档

## 概述

本文档描述了家庭资产记账应用中AI功能的产品设计方案，包括LLM（大语言模型）和VL（多模态视觉模型）两类模型的应用场景、实施优先级和设计原则。

## 核心价值定位

AI功能的核心价值在于解决记账应用的两大核心痛点：

1. **降低录入成本**：从"多步填写"到"一句话/一张图"
2. **提升数据价值**：从"记录数据"到"生成洞察"

## LLM模型应用场景

### 1. 自然语言记账（核心功能）

#### 痛点
用户需要逐项填写描述、金额、分类、账户、预算关联等6-7个字段，操作繁琐。

#### 解决方案
用户通过自然语言描述交易，AI自动提取关键信息并填充表单。

#### 使用示例
```
用户输入："今天在星巴克买了杯拿铁，花了35块，用的支付宝"

AI自动提取：
- 描述："星巴克拿铁"
- 金额：35
- 分类：餐饮 → 咖啡
- 账户：支付宝（根据历史习惯自动选择）
- 预算：自动关联"餐饮"信封预算
- 日期：今天
```

#### 价值
将6-7步操作简化为1句话，大幅降低记账门槛。

#### 技术要点
- 使用LLM模型进行自然语言理解
- 结合用户历史数据（账户使用习惯、分类偏好）进行智能推荐
- 支持多轮对话澄清模糊信息

---

### 2. 智能分类建议（高频场景）

#### 痛点
用户不确定交易应该归类到哪个分类，或分类层级复杂难以选择。

#### 解决方案
根据交易描述，AI自动推荐最合适的分类和子分类。

#### 使用示例
```
用户输入："买了iPhone 15 Pro"

AI建议：
- 分类：购物 → 电子产品
- 子分类：手机
- 预算关联：自动关联"数码产品"预算
- 账户建议：根据历史习惯推荐账户
```

#### 价值
减少用户思考时间，提高分类准确性。

#### 技术要点
- 基于交易描述进行语义理解
- 结合用户历史分类习惯
- 支持用户确认或修改建议

---

### 3. 财务洞察生成（增值功能）

#### 痛点
用户有大量交易数据，但缺乏有价值的财务洞察和建议。

#### 解决方案
AI分析交易历史，生成个性化的财务洞察和建议。

#### 使用示例
```
AI分析结果：
- "本月餐饮支出比上月增加30%，主要因为周末聚餐增多"
- "建议将'娱乐'预算的20%转移到'教育'，因为最近学习支出增加"
- "本月总支出已超过预算的80%，建议控制'购物'类别支出"
```

#### 价值
从被动记录转为主动分析，帮助用户做出更好的财务决策。

#### 技术要点
- 分析交易历史数据
- 识别消费模式和趋势
- 结合预算数据生成建议
- 支持按周期（日/周/月/年）生成报告

---

### 4. 清账差额智能解释（创新功能）

#### 痛点
清账时发现钱包余额与预期不符，但不知道差额花在哪里。

#### 解决方案
AI分析交易记录和消费习惯，智能解释清账差额。

#### 使用示例
```
用户输入："这个月钱包少了500块，不知道花哪了"

AI分析：
- 扫描交易记录
- 识别未记录的小额支出模式
- 建议："根据您的消费习惯，可能是：咖啡（约150元）、午餐（约200元）、交通（约150元）"
```

#### 价值
帮助用户理解资金流向，发现遗漏的交易记录。

#### 技术要点
- 分析清账会话的差额数据
- 结合历史交易模式
- 识别常见的小额支出类型
- 提供差额分解建议

---

## VL模型应用场景

### 1. 发票/收据识别（核心功能）

#### 痛点
手动录入发票信息繁琐且易错，需要逐项填写商家、金额、日期、商品明细等。

#### 解决方案
拍照发票或收据，AI自动识别并创建交易记录。

#### 使用示例
```
用户操作：
1. 拍照发票
2. AI识别：
   - 商家名称：星巴克
   - 金额：35.00元
   - 日期：2025-01-13
   - 商品明细：拿铁咖啡 × 1
3. 自动创建交易记录
4. 自动分类：餐饮 → 咖啡
5. 自动关联预算：餐饮预算
```

#### 价值
将3分钟手动录入缩短为10秒拍照，大幅提升记账效率。

#### 技术要点
- 使用Vision模型进行OCR识别
- 识别发票/收据的关键信息（商家、金额、日期、商品）
- 自动匹配分类和预算
- 支持多种发票格式（增值税发票、普通发票、收据等）

---

### 2. 银行账单识别（高频场景）

#### 痛点
每月需要逐条录入信用卡账单，操作繁琐且容易出错。

#### 解决方案
拍照银行账单，AI自动识别并批量创建交易记录。

#### 使用示例
```
用户操作：
1. 拍照银行账单（信用卡账单）
2. AI识别：
   - 自动提取所有交易记录
   - 识别交易日期、金额、商户名称
   - 识别交易类型（消费、还款等）
3. 批量创建交易记录
4. 自动分类（根据商户名称）
5. 识别重复交易（避免重复录入）
```

#### 价值
将30分钟的手动录入缩短为2分钟拍照识别，大幅提升效率。

#### 技术要点
- OCR识别银行账单表格
- 解析交易列表
- 自动去重（识别已存在的交易）
- 批量创建交易记录

---

### 3. 资产拍照估值（创新功能）

#### 痛点
资产估值需要手动查询市场价格，操作繁琐，特别是消费资产（电脑、家具、珠宝等）。

#### 解决方案
拍照资产，AI识别品牌型号并估算价值。

#### 使用示例
```
用户操作：
1. 拍照资产（如：MacBook Pro）
2. AI识别：
   - 品牌：Apple
   - 型号：MacBook Pro 14英寸
   - 成色：9成新
   - 估算价值：8,000元（基于市场数据）
3. 自动更新资产记录
```

#### 价值
快速完成资产估值，特别适用于消费资产管理。

#### 技术要点
- 识别资产品牌、型号、成色
- 结合市场数据估算价值
- 支持多种资产类型（电子产品、家具、珠宝等）
- 提供估值置信度

---

### 4. 工资条识别（实用功能）

#### 痛点
每月需要手动录入工资明细，包括基本工资、津贴、奖金、五险一金、个税等。

#### 解决方案
拍照工资条，AI自动识别并更新工资收入设置。

#### 使用示例
```
用户操作：
1. 拍照工资条
2. AI识别：
   - 基本工资：34,000元
   - 津贴：住房补贴、餐补、交通补贴
   - 奖金：季度奖、项目奖
   - 五险一金：社保、公积金
   - 个税：个人所得税
3. 自动更新工资收入设置
4. 自动计算净收入
```

#### 价值
快速完成工资录入，避免手动计算错误。

#### 技术要点
- OCR识别工资条表格
- 解析各项收入和扣除项
- 自动更新工资收入模型
- 验证数据合理性

---

## 实施优先级

### 第一阶段（MVP）- 核心功能
**目标**：验证AI功能的核心价值，快速上线基础功能

1. **自然语言记账（LLM）**
   - 优先级：最高
   - 价值：直接解决用户录入痛点
   - 技术难度：中等

2. **发票/收据识别（VL）**
   - 优先级：最高
   - 价值：高频场景，大幅提升效率
   - 技术难度：中等

**预计时间**：2-3周

---

### 第二阶段（增强）- 高频场景
**目标**：覆盖更多使用场景，提升用户体验

3. **智能分类建议（LLM）**
   - 优先级：高
   - 价值：提升分类准确性
   - 技术难度：低

4. **银行账单识别（VL）**
   - 优先级：高
   - 价值：高频场景，批量处理
   - 技术难度：中等

5. **工资条识别（VL）**
   - 优先级：中
   - 价值：实用功能，减少手动录入
   - 技术难度：中等

**预计时间**：3-4周

---

### 第三阶段（增值）- 创新功能
**目标**：提供差异化价值，增强用户粘性

6. **财务洞察生成（LLM）**
   - 优先级：中
   - 价值：从记录到分析，提升数据价值
   - 技术难度：高

7. **清账差额智能解释（LLM）**
   - 优先级：中
   - 价值：创新功能，解决清账痛点
   - 技术难度：高

8. **资产拍照估值（VL）**
   - 优先级：低
   - 价值：创新功能，提升资产管理体验
   - 技术难度：高

**预计时间**：4-6周

---

## 设计原则

### 1. 降低录入成本
- **原则**：从"多步填写"到"一句话/一张图"
- **实践**：
  - 自然语言记账减少操作步骤
  - 图片识别自动填充表单
  - 智能推荐减少用户选择

### 2. 提升数据价值
- **原则**：从"记录数据"到"生成洞察"
- **实践**：
  - 财务洞察分析帮助决策
  - 清账差额解释发现遗漏
  - 预算建议优化支出

### 3. 保持用户控制
- **原则**：AI建议，用户确认
- **实践**：
  - 所有AI提取的信息都需要用户确认
  - 支持用户修改和调整
  - 提供"不使用AI"的选项

### 4. 无缝集成
- **原则**：与现有三层架构深度集成
- **实践**：
  - 自然语言记账集成到交易流水模块
  - 发票识别集成到添加交易页面
  - 财务洞察集成到数据概览页面
  - 清账差额解释集成到清账模块

### 5. 渐进式增强
- **原则**：AI功能作为增强，不影响核心流程
- **实践**：
  - 保留传统录入方式
  - AI功能作为快捷入口
  - 用户可以选择使用或跳过

---

## 技术实现要点

### LLM模型集成

#### 1. 自然语言记账
```dart
// 伪代码示例
Future<Transaction> parseNaturalLanguage(String input) async {
  final messages = [
    AiMessage(
      role: 'system',
      content: '你是一个财务记账助手，从用户描述中提取交易信息...',
    ),
    AiMessage(role: 'user', content: input),
  ];
  
  final response = await aiService.sendMessage(messages: messages);
  // 解析JSON格式的交易信息
  return Transaction.fromJson(jsonDecode(response.content));
}
```

#### 2. 智能分类建议
- 结合用户历史分类数据
- 使用few-shot learning提供示例
- 支持多轮对话澄清

#### 3. 财务洞察生成
- 分析交易历史数据
- 识别消费模式和趋势
- 结合预算数据生成建议

### VL模型集成

#### 1. 发票/收据识别
```dart
// 伪代码示例
Future<Transaction> recognizeInvoice(String imagePath) async {
  // 上传图片到服务器或转换为base64
  final imageUrl = await uploadImage(imagePath);
  
  final messages = [
    AiMessage(
      role: 'user',
      content: '识别这张发票/收据，提取商家、金额、日期、商品明细',
      images: [imageUrl],
    ),
  ];
  
  final response = await aiService.sendVisionMessage(messages: messages);
  // 解析识别结果
  return Transaction.fromJson(jsonDecode(response.content));
}
```

#### 2. 银行账单识别
- OCR识别表格结构
- 解析交易列表
- 批量创建交易记录

#### 3. 资产拍照估值
- 识别资产品牌、型号
- 结合市场数据估算价值
- 提供估值置信度

---

## 用户体验设计

### 1. 自然语言记账入口
- **位置**：添加交易页面顶部
- **交互**：
  - 语音输入按钮（可选）
  - 文本输入框，支持自然语言
  - 实时显示AI解析结果预览
  - 确认按钮创建交易

### 2. 发票识别入口
- **位置**：添加交易页面，相机图标
- **交互**：
  - 点击相机图标
  - 选择拍照或从相册选择
  - 显示识别进度
  - 展示识别结果，用户确认或修改

### 3. 财务洞察展示
- **位置**：数据概览页面，新增"AI洞察"卡片
- **交互**：
  - 卡片展示关键洞察
  - 点击查看详细分析
  - 支持刷新生成新洞察

### 4. 清账差额解释
- **位置**：清账差额分析页面
- **交互**：
  - 显示AI建议的差额分解
  - 支持一键创建建议的交易记录
  - 支持手动调整

---

## 数据隐私与安全

### 1. 数据本地处理优先
- 优先使用本地模型（如支持）
- 敏感数据不上传云端

### 2. 数据脱敏
- 上传图片前进行脱敏处理
- 不传输完整的账户信息

### 3. 用户授权
- 明确告知用户数据使用方式
- 提供关闭AI功能的选项

---

## 成功指标

### 第一阶段（MVP）
- 自然语言记账使用率 > 30%
- 发票识别准确率 > 85%
- 用户满意度 > 4.0/5.0

### 第二阶段（增强）
- AI功能整体使用率 > 50%
- 分类建议采纳率 > 70%
- 银行账单识别准确率 > 90%

### 第三阶段（增值）
- 财务洞察查看率 > 40%
- 清账差额解释使用率 > 60%
- 用户留存率提升 > 20%

---

## 相关文档

- [AI能力技术文档](./AI_CAPABILITY_DOCUMENTATION.md) - AI服务的技术实现细节
- [项目架构文档](../lib/ARCHITECTURE.md) - 整体架构设计
- [交易流水模块文档](../lib/features/transaction_flow/README.md) - 交易流水功能说明
- [家庭信息模块文档](../lib/features/family_info/README.md) - 家庭信息功能说明

---

**文档版本**：v1.0  
**创建时间**：2025-01-13  
**维护者**：产品团队

